<!DOCTYPE html>

<html lang="ar" dir="rtl">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title data-i18n="title">Ù…ÙƒØªØ¨Ø© Ø²ÙŠØ§Ø¯ - Ø§Ù„Ø±ÙˆÙ‚Ø§Ù† ÙƒÙ„Ù‡ 2026 â˜•</title>

    

    <meta name="theme-color" content="#050505">

    <meta name="apple-mobile-web-app-capable" content="yes">

    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="apple-mobile-web-app-title" content="Ziad Library">

    <link rel="apple-touch-icon" href="favicon.png">

    

    <link rel="manifest" href="manifest.json">

    <link rel="icon" type="image/png" href="favicon.png">

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;600;900&display=swap" rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>

    

    <style>

        :root {

            --primary: #00d4ff; --bg: #050505; --card: #0d1117;

            --text: #ffffff; --border: rgba(255,255,255,0.1); --danger: #ff4d4d;

            --success: #2ecc71;

        }

        [data-theme="light"] { --bg: #f0f2f5; --card: #ffffff; --text: #1a1a1a; --primary: #007bff; --border: rgba(0,0,0,0.1); }

        [data-theme="purple"] { --bg: #1a0b2e; --card: #2d1454; --text: #ffffff; --primary: #bc13fe; --border: rgba(255,255,255,0.1); }

        [data-theme="forest"] { --bg: #0a1a0a; --card: #142d14; --text: #ffffff; --primary: #2ecc71; --border: rgba(255,255,255,0.1); }

        [data-theme="sunset"] { --bg: #1a0f0f; --card: #2d1414; --text: #ffffff; --primary: #e67e22; --border: rgba(255,255,255,0.1); }

        [data-theme="gold"] { --bg: #11110a; --card: #222214; --text: #ffffff; --primary: #f1c40f; --border: rgba(255,255,255,0.1); }

        

        * { box-sizing: border-box; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); }

        body { font-family: 'Cairo', sans-serif; background: var(--bg); color: var(--text); margin: 0; min-height: 100vh; overflow-x: hidden; }

        .floating-badge {

            position: fixed; bottom: 20px; right: 20px;

            background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px);

            border: 1px solid var(--primary); color: var(--primary);

            padding: 10px 20px; border-radius: 50px; font-weight: 900;

            box-shadow: 0 0 20px rgba(0, 212, 255, 0.3); z-index: 9999;

            animation: pulse 2s infinite, float 3s ease-in-out infinite; display: none;

        }

        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(0,212,255,0.4); } 70% { box-shadow: 0 0 0 15px rgba(0,212,255,0); } }

        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        

        #loader { position: fixed; inset: 0; background: #000; display: flex; justify-content: center; align-items: center; z-index: 10000; }

        .spinner { width: 50px; height: 50px; border: 5px solid #111; border-top-color: var(--primary); border-radius: 50%; animation: spin 0.8s infinite ease-in-out; }

        @keyframes spin { to { transform: rotate(360deg); } }

        .header { text-align: center; padding: 30px 0; position: relative; }

        #settingsBtn { display: none; position: absolute; top: 60px; left: 15px; z-index: 100; }

        #downloadBtn { display: none; position: absolute; top: 15px; left: 15px; z-index: 100; }

        #themeToggle { display: none; position: absolute; top: 105px; left: 15px; z-index: 100; }

        .user-logo { width: 100px; height: 100px; border-radius: 20px; border: 2px solid var(--primary); box-shadow: 0 0 20px var(--primary); object-fit: cover; }

        .ziad-name { font-size: 2rem; font-weight: 900; text-shadow: 0 0 15px var(--primary); margin: 10px 0; }

        

        .glass-panel { background: rgba(255,255,255,0.03); backdrop-filter: blur(15px); border: 1px solid var(--border); border-radius: 25px; padding: 35px; width: 90%; max-width: 400px; margin: 40px auto; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }

        input, select, textarea { width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; border: 1px solid var(--border); background: rgba(0,0,0,0.3); color: var(--text); text-align: center; font-family: 'Cairo'; outline: none; }

        input:focus, textarea:focus { border-color: var(--primary); box-shadow: 0 0 10px var(--primary); }

        

        .btn { background: linear-gradient(45deg, #0056b3, var(--primary)); color: white; border: none; padding: 12px; border-radius: 10px; font-weight: 700; cursor: pointer; width: 100%; font-size: 1rem; }

        .btn:hover { transform: translateY(-3px); box-shadow: 0 8px 20px var(--primary); }

        

        #libraryContent { display: none; padding: 20px; max-width: 1300px; margin: auto; animation: fadeIn 0.5s ease; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        

        .top-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; gap: 15px; flex-wrap: wrap; }

        .status-chip { background: var(--card); padding: 8px 16px; border-radius: 50px; border: 1px solid var(--primary); cursor: pointer; font-size: 0.85rem; display: flex; align-items: center; gap: 8px; font-weight: bold; }

        .status-chip:hover { background: var(--primary); color: #000; }

        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: none; z-index: 2000; padding: 0; backdrop-filter: blur(5px); }

        .modal-box { background: var(--card); max-width: 100%; margin: 0; padding: 0; border-radius: 0; border: none; position: relative; max-height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        .controls { display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 12px; background: var(--card); padding: 15px; border-radius: 15px; margin-bottom: 30px; border: 1px solid var(--border); }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }

        

        .card { background: var(--card); border-radius: 20px; padding: 12px; border: 1px solid var(--border); position: relative; overflow: hidden; display: flex; flex-direction: column; }

        .card:hover { transform: translateY(-10px); border-color: var(--primary); box-shadow: 0 10px 20px rgba(0,0,0,0.4); }

        .card-tag { position: absolute; top: 12px; right: 12px; background: var(--primary); color: #000; font-size: 0.7rem; padding: 4px 10px; border-radius: 8px; font-weight: 900; z-index: 5; }

        .preview { width: 100%; aspect-ratio: 3/4; border-radius: 12px; object-fit: cover; background: #111; cursor: pointer; }

        

        .book-title { font-weight: 900; color: var(--primary); text-align: center; margin: 10px 0 5px 0; font-size: 1.1rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        .book-author { font-size: 0.85rem; color: #ccc; text-align: center; margin-bottom: 5px; font-weight: 600; }

        .book-meta { font-size: 0.7rem; color: #777; margin-bottom: 10px; text-align: center; display: flex; justify-content: center; gap: 10px; }

        .card-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: auto; }

        .btn-s { padding: 8px; border-radius: 8px; border: none; font-weight: bold; font-size: 0.8rem; cursor: pointer; color: #fff; transition:0.2s; }

        .btn-edit { background: rgba(255,255,255,0.1); color: var(--primary); border: 1px solid var(--primary); grid-column: span 2; }

        

        .book-rating { color: #f1c40f; font-size: 0.9rem; margin-bottom: 5px; text-align: center; }

        #toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: var(--primary); color: #000; padding: 12px 30px; border-radius: 15px; font-weight: 800; display: none; z-index: 5000; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }

        

        @media (max-width: 600px) {

            .grid { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; }

            .controls { grid-template-columns: 1fr; }

        }

        .footer { text-align: center; padding: 40px; color: #666; font-size: 0.9rem; font-weight: bold; }

        svg.icon { width: 32px; height: 32px; margin-bottom: 5px; stroke: var(--primary); }

    </style>

</head>

<body data-theme="dark" data-lang="ar-EG">

    <div id="loader"><div class="spinner"></div></div>

    <div class="floating-badge" id="floatingBadge" data-i18n="floatingBadge">Ziad Ø§Ù„Ø¨Ø§Ø¨Ø§ ğŸ˜</div>

    

    <div class="header">

        <div id="downloadBtn">

            <button class="status-chip" onclick="playAudio('click'); openDownloadModal()" data-i18n="downloadBooks">ğŸ“š ØªÙ†Ø²ÙŠÙ„ ÙƒØªØ¨</button>

        </div>

        <div id="settingsBtn">

            <button class="status-chip" onclick="playAudio('click'); openSettings()" data-i18n="settings">âš™ï¸ ØªØ¸Ø¨ÙŠØ· Ø§Ù„Ù…Ø³Ø§Ø¦Ù„</button>

        </div>

        <div id="themeToggle">

            <button class="status-chip" onclick="playAudio('click'); toggleTheme()" data-i18n="toggleTheme">ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ ğŸŒ—</button>

        </div>

        <img src="favicon.png" class="user-logo" onerror="this.src='https://cdn-icons-png.flaticon.com/512/1043/1043322.png'">

        <div class="ziad-name" data-i18n="ziadName">Ziad Library <span style="font-size:1rem; vertical-align:middle; color:var(--primary)">VIP</span></div>

    </div>

    <div id="welcomePage" class="glass-panel" style="display:none">

        <h2 style="color:var(--primary); margin-top:0" data-i18n="welcomeTitle">Ù…ÙƒØªØ¨ØªÙƒ Ø§Ù„Ø®Ø§ØµØ© Ø¨ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±Ùƒ</h2>

        <p style="font-size:0.9rem; color:#aaa; margin-bottom:15px;" data-i18n="welcomeDesc">Ù‡Ø°Ù‡ Ù…ÙƒØªØ¨Ø© Ø´Ø®ØµÙŠØ© Ù„Ø¥Ø¯Ø§Ø±Ø© ÙƒØªØ¨Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© Ø¨Ø£Ù…Ø§Ù† ÙˆØ±ÙˆÙ‚Ø§Ù†.</p>

        <button class="btn" onclick="choosePasswordMode()" data-i18n="createPassword">Ø§Ù†Ø´ÙŠ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>

        <button class="btn" style="background:#333; margin-top:10px" onclick="chooseNoPasswordMode()" data-i18n="startNoPassword">Ø§Ø¨Ø¯Ø§ Ø¨Ø¯ÙˆÙ† ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±</button>

    </div>

    <div id="loginPage" class="glass-panel">

        <h2 id="loginTitle" style="color:var(--primary); margin-top:0" data-i18n="loginTitle">Ø®Ø´ Ø¨Ø±Ø¬Ù„Ùƒ Ø§Ù„ÙŠÙ…ÙŠÙ† ÙŠØ§ Ù…Ø¹Ù„Ù… ğŸ¦µ</h2>

        <p id="loginDesc" style="font-size:0.9rem; color:#aaa; margin-bottom:15px; display:none" data-i18n="loginDesc">Ø´ÙƒÙ„Ùƒ Ø£ÙˆÙ„ Ù…Ø±Ø© ØªØ´Ø±ÙÙ†Ø§ØŒ Ø§Ø¹Ù…Ù„Ùƒ ÙƒÙ„Ù…Ø© Ø³Ø± Ø¹Ø´Ø§Ù† Ù…Ø­Ø¯Ø´ ÙŠÙØªØ´ ÙÙŠ ÙƒØªØ¨Ùƒ:</p>

        <input type="password" id="passIn" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ÙŠØ§ Ø´Ù‚ÙŠÙ‚" data-i18n-placeholder="passwordPlaceholder">

        <div id="secSetup" style="display:none">

            <input type="text" id="secQuestion" placeholder="Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£Ù…Ø§Ù† (Ù…Ø«Ù„: Ø·ÙˆÙ„Ùƒ ÙƒØ§Ù…ØŸ)" data-i18n-placeholder="secQuestionPlaceholder">

            <input type="text" id="secAnswer" placeholder="Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø£Ù…Ø§Ù† (Ø§ÙØªÙƒØ±Ù‡Ø§ ÙƒÙˆÙŠØ³)" data-i18n-placeholder="secAnswerPlaceholder">

        </div>

        <button id="loginBtn" class="btn" onclick="handleAuth()" data-i18n="loginBtn">Ø§ÙØªØ­ ÙŠØ§ Ø³Ù…Ø³Ù… ğŸ”“</button>

        <p id="forgotPassLink" onclick="playAudio('click'); showPage('secPage')" style="cursor:pointer; font-size:0.8rem; margin-top:20px; color:#555" data-i18n="forgotPass">Ù†Ø³ÙŠØª Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ØŸ ÙƒØ¨Ø± Ø¯Ù…Ø§ØºÙƒ ÙˆØ¯ÙˆØ³ Ù‡Ù†Ø§</p>

        <button class="btn" style="background:#198754; margin-top:15px" onclick="playAudio('click'); openContactModal()" data-i18n="contactUs">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ ğŸ“</button>

        <button class="btn" style="background:#6f42c1; margin-top:15px" onclick="playAudio('click'); openAboutModal()" data-i18n="aboutUs">Ù„Ù…Ø­Ø© Ø¹Ù†Ø§ â„¹ï¸</button>

    </div>

    <div id="secPage" class="glass-panel" style="display:none">

        <h3 style="color:var(--primary)" data-i18n="forgotTitle">Ù†Ø³ÙŠØª ÙˆÙ„Ø§ Ø¥ÙŠÙ‡ØŸ ğŸ¤”</h3>

        <p style="font-size:0.9rem" id="secQuestionText" data-i18n="secQuestionText">Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£Ù…Ø§Ù†: </p>

        <input type="text" id="secAns" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ù‡Ù†Ø§" data-i18n-placeholder="secAnsPlaceholder">

        <button class="btn" onclick="checkSec()" data-i18n="proceed">ÙŠÙ„Ø§ Ø¨ÙŠÙ†Ø§</button>

        <button class="btn" style="background:transparent; color:#777; margin-top:10px" onclick="playAudio('click'); showPage('loginPage')" data-i18n="back">Ø§Ø±Ø¬Ø¹ ÙŠØ§ Ù…Ø¬Ù†ÙˆÙ†</button>

    </div>

    <div id="libraryContent">

        <div class="top-nav">

            <div style="display:flex; gap:10px">

                <div class="status-chip" onclick="playAudio('popup');" id="storageChip" data-i18n="storage">ğŸ’¾ Ø§Ù„Ù…Ø®Ø²Ù†: <span id="totalStorage">0 KB</span></div>

                <div class="status-chip" onclick="playAudio('trash'); showBin()" style="border-color:var(--danger); color:var(--danger)" data-i18n="bin">ğŸ—‘ï¸ Ø§Ù„Ø²Ø¨Ø§Ù„Ø© (<span id="binCount">0</span>)</div>

            </div>

            <div style="display:flex; gap:10px">

                <button class="status-chip" style="background:#198754; color:#fff; border:none" onclick="playAudio('success'); exportData()" data-i18n="export">ğŸ“¤ Ø®Ø¯ Ù†Ø³Ø®Ø© (ØªØµØ¯ÙŠØ±)</button>

                <button class="status-chip" style="background:#6f42c1; color:#fff; border:none" onclick="playAudio('click'); document.getElementById('importFile').click()" data-i18n="import">ğŸ“¥ Ø±Ø¬Ø¹ Ø§Ù„Ù†Ø³Ø®Ø© (Ø§Ø³ØªÙŠØ±Ø§Ø¯)</button>

                <input type="file" id="importFile" accept=".json" style="display:none" onchange="importData(event)">

            </div>

        </div>

        <div class="controls">

            <input type="text" id="search" placeholder="ğŸ” Ø¨ØªØ¯ÙˆØ± Ø¹Ù„Ù‰ Ø¥ÙŠÙ‡ ÙŠØ§ ØºØ§Ù„ÙŠØŸ" oninput="render()" data-i18n-placeholder="searchPlaceholder">

            <select id="catFilter" onchange="playAudio('click'); render()">

                <option value="all" data-i18n="allCategories">ğŸ“ ÙƒÙ„Ù‡ Ø¹Ù„Ù‰ Ø¨Ø¹Ø¶Ù‡</option>

                <option value="ÙƒØªØ¨" data-i18n="booksCat">ğŸ“š ÙƒØªØ¨ Ø¬Ø¯</option>

                <option value="Ø±ÙˆØ§ÙŠØ§Øª" data-i18n="novelsCat">ğŸ­ Ø±ÙˆØ§ÙŠØ§Øª ÙˆØ­ÙƒØ§ÙŠØ§Øª</option>

                <option value="Ù…Ù„Ø®ØµØ§Øª" data-i18n="summariesCat">ğŸ“ Ø¨Ø±Ø´Ø§Ù…Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</option>

                <option value="Ø£Ø®Ø±Ù‰" data-i18n="othersCat">âœ¨ Ø­Ø§Ø¬Ø§Øª ØªØ§Ù†ÙŠØ©</option>

            </select>

            <select id="sort" onchange="playAudio('click'); render()">

                <option value="new" data-i18n="sortNew">ğŸ•’ Ù„Ø³Ù‡ ÙˆØ§ØµÙ„</option>

                <option value="az" data-i18n="sortAz">ğŸ”¤ Ù…Ù† Ø§Ù„Ø£Ù„Ù Ù„Ù„ÙŠØ§Ø¡</option>

            </select>

            <button class="btn" onclick="playAudio('popup'); document.getElementById('fileIn').click()" data-i18n="uploadBtn">â• Ø§Ø±ÙØ¹ ÙŠØ§ Ù†Ø¬Ù…</button>

            <input type="file" id="fileIn" accept=".pdf" style="display:none" onchange="upload(event)">

        </div>

        <div class="grid" id="grid"></div>

    </div>

    <div id="settingsModal" class="modal"><div class="modal-box">

        <h4 style="color:var(--primary); margin-top:0" data-i18n="settingsTitle">ØªØ¸Ø¨ÙŠØ· Ø§Ù„Ù…Ø³Ø§Ø¦Ù„ âš™ï¸</h4>

        <label data-i18n="themeLabel">Ø§Ù„Ø±ÙˆÙ‚Ø§Ù† ÙˆØ§Ù„Ø£Ù„ÙˆØ§Ù†:</label>

        <select id="themeSelect" onchange="playAudio('click'); setTheme(this.value)">

            <option value="dark" data-i18n="darkTheme">Ø¶Ù„Ù…Ø© (Ù„Ù„Ø¹Ø¸Ù…Ø§Ø¡)</option><option value="light" data-i18n="lightTheme">Ù†ÙˆØ± (ÙŠØ¹Ù…ÙŠ Ø§Ù„Ø¹ÙŠÙ†)</option><option value="purple" data-i18n="purpleTheme">Ø¨Ù†ÙØ³Ø¬ÙŠ (Ø±ÙˆÙ‚Ø§Ù†)</option><option value="forest" data-i18n="forestTheme">ØºØ§Ø¨Ø© (Ø·Ø¨ÙŠØ¹Ø©)</option><option value="sunset" data-i18n="sunsetTheme">ØºØ±ÙˆØ¨ (Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠ)</option><option value="gold" data-i18n="goldTheme">Ø¯Ù‡Ø¨ÙŠ (ÙŠØ§ Ø¨Ø§Ø´Ø§)</option>

        </select>

        <label data-i18n="languageLabel">ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ©:</label>

        <select id="langSelect" onchange="playAudio('click'); setLanguage(this.value)">

            <option value="ar-EG" data-i18n="egyptianArabic">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ù…ØµØ±ÙŠØ©</option>

            <option value="ar" data-i18n="standardArabic">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„ÙØµØ­Ù‰</option>

            <option value="en" data-i18n="english">English</option>

        </select>

        <button class="btn" onclick="playAudio('click'); openChangePassModal()" data-i18n="changePass">ØºÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ğŸ”‘</button>

        <button class="btn" style="background:var(--danger); margin-top:15px" onclick="playAudio('trash'); deleteAllBooks()" data-i18n="deleteAll">Ø§Ø­Ø°Ù ÙƒÙ„Ù‡ ğŸ—‘ï¸</button>

        <button class="btn" style="background:#198754; margin-top:15px" onclick="playAudio('click'); openContactModal()" data-i18n="contactUs">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ ğŸ“</button>

        <button class="btn" style="background:#6f42c1; margin-top:15px" onclick="playAudio('click'); openAboutModal()" data-i18n="aboutUs">Ù„Ù…Ø­Ø© Ø¹Ù†Ø§ â„¹ï¸</button>

        <button class="btn" style="background:#333; margin-top:15px" onclick="playAudio('click'); closeModals()" data-i18n="close">ÙÙƒÙƒ (Ø¥ØºÙ„Ø§Ù‚)</button>

    </div></div>

    <div id="changePassModal" class="modal"><div class="modal-box">

        <h4 style="color:var(--primary); margin-top:0" data-i18n="changePassTitle">ØºÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ÙˆØ³Ø¤Ø§Ù„ Ø§Ù„Ø£Ù…Ø§Ù†</h4>

        <label data-i18n="newPassLabel">ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:</label>

        <input type="password" id="newPassInput" placeholder="Ø§ÙƒØªØ¨ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©" data-i18n-placeholder="newPassPlaceholder">

        <label data-i18n="newSecQLabel">Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯:</label>

        <input type="text" id="newSecQuestion" placeholder="Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ù…Ø«Ù„: Ø·ÙˆÙ„Ùƒ ÙƒØ§Ù…ØŸ)" data-i18n-placeholder="newSecQPlaceholder">

        <label data-i18n="newSecALabel">Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:</label>

        <input type="text" id="newSecAnswer" placeholder="Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©" data-i18n-placeholder="newSecAPlaceholder">

        <button class="btn" onclick="playAudio('success'); saveNewPassAndSec()" data-i18n="saveChanges">Ø§Ø¹ØªÙ…Ø¯ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ğŸ‘Œ</button>

        <button class="btn" style="background:#333; margin-top:10px" onclick="playAudio('click'); closeModals()" data-i18n="close">Ø¥ØºÙ„Ø§Ù‚</button>

    </div></div>

    <div id="aboutModal" class="modal"><div class="modal-box">

        <h4 style="color:var(--primary); margin-top:0" data-i18n="aboutTitle">Ù„Ù…Ø­Ø© Ø¹Ù†Ø§</h4>

        <p style="font-size:0.9rem; color:#aaa; margin-bottom:15px;" data-i18n="aboutDesc">Ø¯Ù‡ Ù…ÙˆÙ‚Ø¹ Ù…ÙƒØªØ¨Ø© Ø²ÙŠØ§Ø¯ØŒ Ø§Ù„Ø±ÙˆÙ‚Ø§Ù† ÙƒÙ„Ù‡ 2026 â˜•ØŒ Ø¹Ø´Ø§Ù† ØªØ¯ÙŠØ± ÙƒØªØ¨Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© Ø¨Ø£Ù…Ø§Ù† ÙˆØ³Ù‡ÙˆÙ„Ø© ÙŠØ§ Ù…Ø¹Ù„Ù…. Ù‡Ù†Ø§ ØªÙ‚Ø¯Ø± ØªØ±ÙØ¹ ÙƒØªØ¨Ùƒ Ø§Ù„Ù€ PDFØŒ ØªØµÙ†ÙÙ‡Ø§ØŒ ØªØ¨Ø­Ø« ÙÙŠÙ‡Ø§ØŒ ØªÙ‚Ø±Ø§Ù‡Ø§ØŒ ÙˆØªØ­Ù…Ù„Ù‡Ø§ Ø²ÙŠ Ù…Ø§ Ø§Ù†Øª Ø¹Ø§ÙŠØ². Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø¯ÙŠ Ø´Ø®ØµÙŠØ© ØªÙ…Ø§Ù…Ù‹Ø§ØŒ Ù…Ø¹ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¹Ø´Ø§Ù† Ù…Ø­Ø¯Ø´ ÙŠÙØªØ´ ÙÙŠ Ø­Ø§Ø¬Ø§ØªÙƒØŒ ÙˆÙÙŠÙ‡Ø§ Ø®Ø§ØµÙŠØ© ØªØµØ¯ÙŠØ± ÙˆØ§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø´Ø§Ù† ØªÙ†Ù‚Ù„ ÙƒØªØ¨Ùƒ Ø¨Ø³Ù‡ÙˆÙ„Ø©. ÙƒÙ…Ø§Ù† ÙÙŠÙ‡Ø§ Ø³Ù„Ø© Ù…Ù‡Ù…Ù„Ø§Øª Ø¹Ø´Ø§Ù† Ù„Ùˆ ØºÙ„Ø·Øª ÙÙŠ Ø­Ø°Ù Ø­Ø§Ø¬Ø© ØªÙ‚Ø¯Ø± ØªØ±Ø¬Ø¹Ù‡Ø§ØŒ ÙˆØªØºÙŠÙŠØ± Ø§Ù„Ø«ÙŠÙ…Ø§Øª Ø¹Ø´Ø§Ù† ØªØ±ÙŠØ­ Ø¹ÙŠÙˆÙ†Ùƒ. ÙƒÙ„ Ø¯Ù‡ Ù…ØµÙ…Ù… Ø¨Ø£Ø­Ø¯Ø« Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø¹Ø´Ø§Ù† ÙŠØ´ØªØºÙ„ Ø¢ÙÙ„Ø§ÙŠÙ† ÙƒÙ…Ø§Ù† Ø²ÙŠ Ø§Ù„Ù€ PWA. Ù…Ù† ØµÙ†Ø¹ ÙˆØ¥Ø¹Ø¯Ø§Ø¯ Ø²ÙŠØ§Ø¯ Ø§Ù„Ø¯Ø±ÙŠÙ†ÙŠØŒ ÙŠØ§ Ø±ÙŠØ³!</p>

        <button class="btn" style="background:#333; margin-top:10px" onclick="playAudio('click'); closeModals()" data-i18n="close">Ø¥ØºÙ„Ø§Ù‚</button>

    </div></div>

    <div id="contactModal" class="modal"><div class="modal-box">

        <h4 style="color:var(--primary); margin-top:0" data-i18n="contactTitle">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ ğŸ“¬</h4>

        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 20px;">

            <div style="text-align: center; padding: 15px; background: var(--card); border: 1px solid var(--border); border-radius: 15px;">

                <svg class="icon" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>

                <div style="font-weight: bold; color: var(--primary);" data-i18n="phoneWhatsapp">Ø§ØªØµØ§Ù„/ÙˆØ§ØªØ³Ø§Ø¨</div>

                <a href="tel:01055662785" class="btn-s" style="background:var(--primary); color:#000; margin-top:5px; display:block; text-decoration:none;" data-i18n="call">Ø§ØªØµØ§Ù„</a>

                <a href="https://wa.me/01055662785" target="_blank" class="btn-s" style="background:#25D366; color:#fff; margin-top:5px; display:block; text-decoration:none;" data-i18n="whatsapp">ÙˆØ§ØªØ³Ø§Ø¨</a>

            </div>

            <div style="text-align: center; padding: 15px; background: var(--card); border: 1px solid var(--border); border-radius: 15px;">

                <svg class="icon" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/></svg>

                <div style="font-weight: bold; color: var(--primary);" data-i18n="facebook">ÙÙŠØ³Ø¨ÙˆÙƒ</div>

                <a href="https://www.facebook.com/profile.php?id=61583039190517&locale=ar_AR" target="_blank" style="color: #1877F2; text-decoration: none;" data-i18n="visitPage">Ø²ÙŠØ§Ø±Ø© Ø§Ù„ØµÙØ­Ø©</a>

            </div>

            <div style="text-align: center; padding: 15px; background: var(--card); border: 1px solid var(--border); border-radius: 15px;">

                <svg class="icon" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7.8,2H16.2C19.4,2 22,4.6 22,7.8V16.2A5.8,5.8 0 0,1 16.2,22H7.8C4.6,22 2,19.4 2,16.2V7.8A5.8,5.8 0 0,1 7.8,2M7.6,4A3.6,3.6 0 0,0 4,7.6V16.4A3.6,3.6 0 0,0 7.6,20H16.4A3.6,3.6 0 0,0 20,16.4V7.6A3.6,3.6 0 0,0 16.4,4H7.6M18,5.5A1.5,1.5 0 0,1 16.5,7A1.5,1.5 0 0,1 15,5.5A1.5,1.5 0 0,1 16.5,4A1.5,1.5 0 0,1 18,5.5M12,9.5A3.5,3.5 0 0,1 8.5,13A3.5,3.5 0 0,1 5,9.5A3.5,3.5 0 0,1 8.5,6A3.5,3.5 0 0,1 12,9.5M7,16L9.5,13.5L11,15L13.5,12.5L16,15"/></svg>

                <div style="font-weight: bold; color: var(--primary);">Ø¥Ù†Ø³ØªØºØ±Ø§Ù…</div>

                <a href="https://www.instagram.com/ziad_dreeny_1" target="_blank" style="color: #E4405F; text-decoration: none;" data-i18n="visitPage">Ø²ÙŠØ§Ø±Ø© Ø§Ù„ØµÙØ­Ø©</a>

            </div>

        </div>

        <button class="btn" style="background:#333; margin-top:10px" onclick="playAudio('click'); closeModals()" data-i18n="close">Ø¥ØºÙ„Ø§Ù‚</button>

    </div></div>

    <div id="editModal" class="modal"><div class="modal-box">

        <h4 style="color:var(--primary); margin-top:0" data-i18n="editTitle">Ø¸Ø¨Ø· Ø§Ù„ÙƒØªØ§Ø¨ âœï¸</h4>

        <input type="hidden" id="editBookId">

        <input type="text" id="editName" placeholder="Ø§Ø³Ù… Ø§Ù„ÙƒØªØ§Ø¨" data-i18n-placeholder="bookNamePlaceholder">

        <input type="text" id="editAuthor" placeholder="Ø§Ù„ÙƒØ§ØªØ¨" data-i18n-placeholder="authorPlaceholder">

        <select id="editCat">

            <option value="ÙƒØªØ¨" data-i18n="booksCat">ğŸ“š ÙƒØªØ¨ Ø¬Ø¯</option>

            <option value="Ø±ÙˆØ§ÙŠØ§Øª" data-i18n="novelsCat">ğŸ­ Ø±ÙˆØ§ÙŠØ§Øª ÙˆØ­ÙƒØ§ÙŠØ§Øª</option>

            <option value="Ù…Ù„Ø®ØµØ§Øª" data-i18n="summariesCat">ğŸ“ Ø¨Ø±Ø´Ø§Ù…Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</option>

            <option value="Ø£Ø®Ø±Ù‰" data-i18n="othersCat">âœ¨ Ø­Ø§Ø¬Ø§Øª ØªØ§Ù†ÙŠØ©</option>

        </select>

        <textarea id="editDesc" placeholder="ÙˆØµÙ Ø§Ù„ÙƒØªØ§Ø¨" data-i18n-placeholder="descPlaceholder"></textarea>

        <button class="btn" onclick="playAudio('success'); saveEdit()" data-i18n="save">Ø§Ø­ÙØ¸ ÙŠØ§ ÙˆØ­Ø´</button>

        <button class="btn" style="background:#333; margin-top:10px" onclick="playAudio('click'); closeModals()" data-i18n="close">Ø¥ØºÙ„Ø§Ù‚</button>

    </div></div>

    <div id="binModal" class="modal"><div class="modal-box">

        <h4 style="color:var(--danger); margin-top:0" data-i18n="binTitle">Ø§Ù„Ø²Ø¨Ø§Ù„Ø© ğŸ—‘ï¸</h4>

        <div id="binList" style="overflow-y:auto; flex-grow:1; padding:15px"></div>

        <button class="btn" style="background:var(--danger)" onclick="playAudio('trash'); emptyBin()" data-i18n="emptyBin">ÙØ±Ù… ÙƒÙ„Ù‡</button>

        <button class="btn" style="background:#333; margin-top:10px" onclick="playAudio('click'); closeModals()" data-i18n="close">Ø¥ØºÙ„Ø§Ù‚</button>

    </div></div>

    <div id="downloadModal" class="modal"><div class="modal-box">

        <h4 style="color:var(--primary); margin-top:0" data-i18n="downloadTitle">ØªÙ†Ø²ÙŠÙ„ ÙƒØªØ¨ ğŸ“š</h4>

        <p style="font-size:0.9rem; color:#aaa; margin-bottom:15px;" data-i18n="downloadDesc">Ø§Ø®ØªØ± Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ù„ÙŠ Ø¹Ø§ÙŠØ² ØªØ­Ù…Ù„Ù‡Ø§ ÙŠØ§ Ù…Ø¹Ù„Ù…ØŒ ÙˆØ¨Ø¹Ø¯ÙŠÙ† Ø¯ÙˆØ³ Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±:</p>

        <div id="downloadList" style="overflow-y:auto; flex-grow:1; padding:15px"></div>

        <button class="btn" onclick="playAudio('success'); downloadSelected()" data-i18n="downloadSelected">Ø­Ù…Ù„ Ø§Ù„Ù„ÙŠ Ø§Ø®ØªØ±ØªÙ‡ ğŸ‘‡</button>

        <button class="btn" style="background:#333; margin-top:10px" onclick="playAudio('click'); closeModals()" data-i18n="close">Ø¥ØºÙ„Ø§Ù‚</button>

    </div></div>

    <div id="toast"></div>

    

    <script>

        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

        

        let db;

        let currentBookId = null;

        const request = indexedDB.open("ziadLib", 1);

        request.onupgradeneeded = (e) => {

            db = e.target.result;

            db.createObjectStore("books", { keyPath: "id", autoIncrement: true });

            db.createObjectStore("bin", { keyPath: "id" });

        };

        request.onsuccess = (e) => {

            db = e.target.result;

            init();

        };

        

        const translations = {

            "ar-EG": {

                title: "Ù…ÙƒØªØ¨Ø© Ø²ÙŠØ§Ø¯ - Ø§Ù„Ø±ÙˆÙ‚Ø§Ù† ÙƒÙ„Ù‡ 2026 â˜•",

                floatingBadge: "Ziad Ø§Ù„Ø¨Ø§Ø¨Ø§ ğŸ˜",

                downloadBooks: "ğŸ“š ØªÙ†Ø²ÙŠÙ„ ÙƒØªØ¨",

                settings: "âš™ï¸ ØªØ¸Ø¨ÙŠØ· Ø§Ù„Ù…Ø³Ø§Ø¦Ù„",

                toggleTheme: "ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ ğŸŒ—",

                ziadName: "Ù…ÙƒØªØ¨Ø© Ø²ÙŠØ§Ø¯",

                welcomeTitle: "Ù…ÙƒØªØ¨ØªÙƒ Ø§Ù„Ø®Ø§ØµØ© Ø¨ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±Ùƒ",

                welcomeDesc: "Ù‡Ø°Ù‡ Ù…ÙƒØªØ¨Ø© Ø´Ø®ØµÙŠØ© Ù„Ø¥Ø¯Ø§Ø±Ø© ÙƒØªØ¨Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© Ø¨Ø£Ù…Ø§Ù† ÙˆØ±ÙˆÙ‚Ø§Ù†.",

                createPassword: "Ø§Ù†Ø´ÙŠ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±",

                startNoPassword: "Ø§Ø¨Ø¯Ø§ Ø¨Ø¯ÙˆÙ† ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±",

                loginTitle: "Ø®Ø´ Ø¨Ø±Ø¬Ù„Ùƒ Ø§Ù„ÙŠÙ…ÙŠÙ† ÙŠØ§ Ù…Ø¹Ù„Ù… ğŸ¦µ",

                loginDesc: "Ø´ÙƒÙ„Ùƒ Ø£ÙˆÙ„ Ù…Ø±Ø© ØªØ´Ø±ÙÙ†Ø§ØŒ Ø§Ø¹Ù…Ù„Ùƒ ÙƒÙ„Ù…Ø© Ø³Ø± Ø¹Ø´Ø§Ù† Ù…Ø­Ø¯Ø´ ÙŠÙØªØ´ ÙÙŠ ÙƒØªØ¨Ùƒ:",

                passwordPlaceholder: "ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ÙŠØ§ Ø´Ù‚ÙŠÙ‚",

                secQuestionPlaceholder: "Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£Ù…Ø§Ù† (Ù…Ø«Ù„: Ø·ÙˆÙ„Ùƒ ÙƒØ§Ù…ØŸ)",

                secAnswerPlaceholder: "Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø£Ù…Ø§Ù† (Ø§ÙØªÙƒØ±Ù‡Ø§ ÙƒÙˆÙŠØ³)",

                loginBtn: "Ø§ÙØªØ­ ÙŠØ§ Ø³Ù…Ø³Ù… ğŸ”“",

                forgotPass: "Ù†Ø³ÙŠØª Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ØŸ ÙƒØ¨Ø± Ø¯Ù…Ø§ØºÙƒ ÙˆØ¯ÙˆØ³ Ù‡Ù†Ø§",

                contactUs: "ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ ğŸ“",

                aboutUs: "Ù„Ù…Ø­Ø© Ø¹Ù†Ø§ â„¹ï¸",

                forgotTitle: "Ù†Ø³ÙŠØª ÙˆÙ„Ø§ Ø¥ÙŠÙ‡ØŸ ğŸ¤”",

                secQuestionText: "Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£Ù…Ø§Ù†: ",

                secAnsPlaceholder: "Ø§ÙƒØªØ¨ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ù‡Ù†Ø§",

                proceed: "ÙŠÙ„Ø§ Ø¨ÙŠÙ†Ø§",

                back: "Ø§Ø±Ø¬Ø¹ ÙŠØ§ Ù…Ø¬Ù†ÙˆÙ†",

                storage: "ğŸ’¾ Ø§Ù„Ù…Ø®Ø²Ù†: ",

                bin: "ğŸ—‘ï¸ Ø§Ù„Ø²Ø¨Ø§Ù„Ø© ",

                export: "ğŸ“¤ Ø®Ø¯ Ù†Ø³Ø®Ø© (ØªØµØ¯ÙŠØ±)",

                import: "ğŸ“¥ Ø±Ø¬Ø¹ Ø§Ù„Ù†Ø³Ø®Ø© (Ø§Ø³ØªÙŠØ±Ø§Ø¯)",

                searchPlaceholder: "ğŸ” Ø¨ØªØ¯ÙˆØ± Ø¹Ù„Ù‰ Ø¥ÙŠÙ‡ ÙŠØ§ ØºØ§Ù„ÙŠØŸ",

                allCategories: "ğŸ“ ÙƒÙ„Ù‡ Ø¹Ù„Ù‰ Ø¨Ø¹Ø¶Ù‡",

                booksCat: "ğŸ“š ÙƒØªØ¨ Ø¬Ø¯",

                novelsCat: "ğŸ­ Ø±ÙˆØ§ÙŠØ§Øª ÙˆØ­ÙƒØ§ÙŠØ§Øª",

                summariesCat: "ğŸ“ Ø¨Ø±Ø´Ø§Ù…Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª",

                othersCat: "âœ¨ Ø­Ø§Ø¬Ø§Øª ØªØ§Ù†ÙŠØ©",

                sortNew: "ğŸ•’ Ù„Ø³Ù‡ ÙˆØ§ØµÙ„",

                sortAz: "ğŸ”¤ Ù…Ù† Ø§Ù„Ø£Ù„Ù Ù„Ù„ÙŠØ§Ø¡",

                uploadBtn: "â• Ø§Ø±ÙØ¹ ÙŠØ§ Ù†Ø¬Ù…",

                settingsTitle: "ØªØ¸Ø¨ÙŠØ· Ø§Ù„Ù…Ø³Ø§Ø¦Ù„ âš™ï¸",

                themeLabel: "Ø§Ù„Ø±ÙˆÙ‚Ø§Ù† ÙˆØ§Ù„Ø£Ù„ÙˆØ§Ù†:",

                darkTheme: "Ø¶Ù„Ù…Ø© (Ù„Ù„Ø¹Ø¸Ù…Ø§Ø¡)",

                lightTheme: "Ù†ÙˆØ± (ÙŠØ¹Ù…ÙŠ Ø§Ù„Ø¹ÙŠÙ†)",

                purpleTheme: "Ø¨Ù†ÙØ³Ø¬ÙŠ (Ø±ÙˆÙ‚Ø§Ù†)",

                forestTheme: "ØºØ§Ø¨Ø© (Ø·Ø¨ÙŠØ¹Ø©)",

                sunsetTheme: "ØºØ±ÙˆØ¨ (Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠ)",

                goldTheme: "Ø¯Ù‡Ø¨ÙŠ (ÙŠØ§ Ø¨Ø§Ø´Ø§)",

                languageLabel: "ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ©:",

                egyptianArabic: "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ù…ØµØ±ÙŠØ©",

                standardArabic: "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„ÙØµØ­Ù‰",

                english: "English",

                changePass: "ØºÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ğŸ”‘",

                deleteAll: "Ø§Ø­Ø°Ù ÙƒÙ„Ù‡ ğŸ—‘ï¸",

                close: "ÙÙƒÙƒ (Ø¥ØºÙ„Ø§Ù‚)",

                changePassTitle: "ØºÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ÙˆØ³Ø¤Ø§Ù„ Ø§Ù„Ø£Ù…Ø§Ù†",

                newPassLabel: "ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:",

                newPassPlaceholder: "Ø§ÙƒØªØ¨ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©",

                newSecQLabel: "Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯:",

                newSecQPlaceholder: "Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ù…Ø«Ù„: Ø·ÙˆÙ„Ùƒ ÙƒØ§Ù…ØŸ)",

                newSecALabel: "Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:",

                newSecAPlaceholder: "Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©",

                saveChanges: "Ø§Ø¹ØªÙ…Ø¯ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ğŸ‘Œ",

                aboutTitle: "Ù„Ù…Ø­Ø© Ø¹Ù†Ø§",

                aboutDesc: "Ø¯Ù‡ Ù…ÙˆÙ‚Ø¹ Ù…ÙƒØªØ¨Ø© Ø²ÙŠØ§Ø¯ØŒ Ø§Ù„Ø±ÙˆÙ‚Ø§Ù† ÙƒÙ„Ù‡ 2026 â˜•ØŒ Ø¹Ø´Ø§Ù† ØªØ¯ÙŠØ± ÙƒØªØ¨Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© Ø¨Ø£Ù…Ø§Ù† ÙˆØ³Ù‡ÙˆÙ„Ø© ÙŠØ§ Ù…Ø¹Ù„Ù…. Ù‡Ù†Ø§ ØªÙ‚Ø¯Ø± ØªØ±ÙØ¹ ÙƒØªØ¨Ùƒ Ø§Ù„Ù€ PDFØŒ ØªØµÙ†ÙÙ‡Ø§ØŒ ØªØ¨Ø­Ø« ÙÙŠÙ‡Ø§ØŒ ØªÙ‚Ø±Ø§Ù‡Ø§ØŒ ÙˆØªØ­Ù…Ù„Ù‡Ø§ Ø²ÙŠ Ù…Ø§ Ø§Ù†Øª Ø¹Ø§ÙŠØ². Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø¯ÙŠ Ø´Ø®ØµÙŠØ© ØªÙ…Ø§Ù…Ù‹Ø§ØŒ Ù…Ø¹ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¹Ø´Ø§Ù† Ù…Ø­Ø¯Ø´ ÙŠÙØªØ´ ÙÙŠ Ø­Ø§Ø¬Ø§ØªÙƒØŒ ÙˆÙÙŠÙ‡Ø§ Ø®Ø§ØµÙŠØ© ØªØµØ¯ÙŠØ± ÙˆØ§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø´Ø§Ù† ØªÙ†Ù‚Ù„ ÙƒØªØ¨Ùƒ Ø¨Ø³Ù‡ÙˆÙ„Ø©. ÙƒÙ…Ø§Ù† ÙÙŠÙ‡Ø§ Ø³Ù„Ø© Ù…Ù‡Ù…Ù„Ø§Øª Ø¹Ø´Ø§Ù† Ù„Ùˆ ØºÙ„Ø·Øª ÙÙŠ Ø­Ø°Ù Ø­Ø§Ø¬Ø© ØªÙ‚Ø¯Ø± ØªØ±Ø¬Ø¹Ù‡Ø§ØŒ ÙˆØªØºÙŠÙŠØ± Ø§Ù„Ø«ÙŠÙ…Ø§Øª Ø¹Ø´Ø§Ù† ØªØ±ÙŠØ­ Ø¹ÙŠÙˆÙ†Ùƒ. ÙƒÙ„ Ø¯Ù‡ Ù…ØµÙ…Ù… Ø¨Ø£Ø­Ø¯Ø« Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø¹Ø´Ø§Ù† ÙŠØ´ØªØºÙ„ Ø¢ÙÙ„Ø§ÙŠÙ† ÙƒÙ…Ø§Ù† Ø²ÙŠ Ø§Ù„Ù€ PWA. Ù…Ù† ØµÙ†Ø¹ ÙˆØ¥Ø¹Ø¯Ø§Ø¯ Ø²ÙŠØ§Ø¯ Ø§Ù„Ø¯Ø±ÙŠÙ†ÙŠØŒ ÙŠØ§ Ø±ÙŠØ³!",

                contactTitle: "ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ ğŸ“¬",

                phoneWhatsapp: "Ø§ØªØµØ§Ù„/ÙˆØ§ØªØ³Ø§Ø¨",

                call: "Ø§ØªØµØ§Ù„",

                whatsapp: "ÙˆØ§ØªØ³Ø§Ø¨",

                facebook: "ÙÙŠØ³Ø¨ÙˆÙƒ",

                visitPage: "Ø²ÙŠØ§Ø±Ø© Ø§Ù„ØµÙØ­Ø©",

                editTitle: "Ø¸Ø¨Ø· Ø§Ù„ÙƒØªØ§Ø¨ âœï¸",

                bookNamePlaceholder: "Ø§Ø³Ù… Ø§Ù„ÙƒØªØ§Ø¨",

                authorPlaceholder: "Ø§Ù„ÙƒØ§ØªØ¨",

                descPlaceholder: "ÙˆØµÙ Ø§Ù„ÙƒØªØ§Ø¨",

                save: "Ø§Ø­ÙØ¸ ÙŠØ§ ÙˆØ­Ø´",

                binTitle: "Ø§Ù„Ø²Ø¨Ø§Ù„Ø© ğŸ—‘ï¸",

                emptyBin: "ÙØ±Ù… ÙƒÙ„Ù‡",

                downloadTitle: "ØªÙ†Ø²ÙŠÙ„ ÙƒØªØ¨ ğŸ“š",

                downloadDesc: "Ø§Ø®ØªØ± Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ù„ÙŠ Ø¹Ø§ÙŠØ² ØªØ­Ù…Ù„Ù‡Ø§ ÙŠØ§ Ù…Ø¹Ù„Ù…ØŒ ÙˆØ¨Ø¹Ø¯ÙŠÙ† Ø¯ÙˆØ³ Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±:",

                downloadSelected: "Ø­Ù…Ù„ Ø§Ù„Ù„ÙŠ Ø§Ø®ØªØ±ØªÙ‡ ğŸ‘‡",

                errorEmpty: "âš ï¸ Ø§ÙƒØªØ¨ Ø£ÙŠ Ø­Ø§Ø¬Ø© ÙŠØ§ Ø¹Ù…!",

                errorSec: "âš ï¸ Ù„Ø§Ø²Ù… ØªÙƒØªØ¨ Ø³Ø¤Ø§Ù„ Ø£Ù…Ø§Ù† ÙˆØ¥Ø¬Ø§Ø¨ØªÙ‡ ÙŠØ§ Ù…Ø¹Ù„Ù…!",

                welcomeMsg: "âœ… Ø£Ù‡Ù„Ø§ Ø¨ÙŠÙƒ ÙŠØ§ Ø±ÙŠØ³ ÙÙŠ Ù…ÙƒØªØ¨ØªÙƒ",

                errorWrongPass: "âŒ ØºÙ„Ø· ÙŠØ§ Ø²Ù…ÙŠÙ„ÙŠ! Ø±ÙƒØ² Ø´ÙˆÙŠØ© ğŸ˜‚",

                libraryWelcome: "Ù†ÙˆØ±Øª Ø§Ù„Ù…ÙƒØªØ¨Ø© ÙŠØ§ Ù‡Ù†Ø¯Ø³Ø© ğŸ’¡",

                passChanged: "âœ… ØºÙŠØ±Ù†Ø§ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ÙˆØ³Ø¤Ø§Ù„ Ø§Ù„Ø£Ù…Ø§Ù†ØŒ Ø§ÙˆØ¹Ù‰ ØªÙ†Ø³Ø§Ù‡Ù… Ø¨Ù‚Ù‰!",

                errorFillAll: "âš ï¸ Ù„Ø§Ø²Ù… ØªÙ…Ù„Ø£ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙŠØ§ Ù…Ø¹Ù„Ù…!",

                confirmDeleteAll: "Ù‡ØªØ­Ø°Ù ÙƒÙ„ Ø§Ù„ÙƒØªØ¨ Ø¨Ø¬Ø¯ØŸ Ù…ÙÙŠØ´ Ø±Ø¬Ø¹Ø© ÙŠØ§ Ø±ÙŠØ³! ğŸ˜±",

                allDeleted: "ğŸ—‘ï¸ Ø¨Ø­.. ÙƒÙ„ Ø§Ù„ÙƒØªØ¨ Ø±Ø§Ø­Øª!",

                secSuccess: "Ø£ÙŠÙˆÙ‡ ÙƒØ¯Ø© ÙŠØ§ ÙˆØ¯ÙŠØ¹! Ù†ÙˆØ±Øª ğŸ˜‚",

                secError: "âš ï¸ Ø¨ØªÙØªÙŠ Ù„ÙŠÙ‡ØŸ ØºÙ„Ø·!",

                uploading: "â³ Ø§ØµØ¨Ø± Ø´ÙˆÙŠØ© Ø¨Ù†Ø­Ù…Ù„ Ø§Ù„ÙƒØªØ§Ø¨...",

                uploadSuccess: "âœ… Ø§Ù„ÙƒØªØ§Ø¨ ÙˆØµÙ„ Ø¨Ø§Ù„Ø³Ù„Ø§Ù…Ø©!",

                defaultAuthor: "ÙØ§Ø¹Ù„ Ø®ÙŠØ±",

                defaultDesc: "Ù…Ù† ØºÙŠØ± ÙˆØµÙ",

                defaultCat: "ÙƒÙˆÙƒØªÙŠÙ„",

                pages: "ÙˆØ±Ù‚Ø©",

                read: "Ù‚Ø±Ø§Ø¡Ø© ğŸ“–",

                download: "Ø­Ù…Ù„ ğŸ‘‡",

                edit: "Ø¸Ø¨Ø·Ù‡ âœï¸",

                delete: "Ø§Ø±Ù…ÙŠÙ‡ ğŸ—‘ï¸",

                foundResults: "ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰",

                noResults: "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬",

                downloading: "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„... Ø§Ø³ØªÙ„Ù‚Ø§Ù‡ ğŸ“¥",

                movedToBin: "ğŸ—‘ï¸ Ø·ÙŠØ±Ù†Ø§Ù‡ ÙÙŠ Ø§Ù„Ø²Ø¨Ø§Ù„Ø©",

                restore: "Ø±Ø¬Ø¹Ù‡ ØªØ§Ù†ÙŠ",

                restored: "Ø±Ø¬Ø¹Ù†Ø§Ù‡ ÙŠÙ†ÙˆØ± Ø§Ù„Ù…ÙƒØªØ¨Ø© âœ¨",

                confirmEmptyBin: "Ù‡ØªÙØ±Ù… Ø§Ù„ÙƒØªØ¨ Ø¯ÙŠ Ø¨Ø¬Ø¯ØŸ Ù…ÙÙŠØ´ Ø±Ø¬Ø¹Ø© ÙŠØ§ Ù…Ø¹Ù„Ù…! ğŸ˜±",

                binEmptied: "Ø¨Ø­.. Ø§Ù„Ø²Ø¨Ø§Ù„Ø© ÙØ¶ÙŠØª ğŸ§¹",

                editSaved: "âœ… Ø¹Ø¯Ù„Ù†Ø§ ÙˆÙƒÙ„Ù‡ ØªÙ…Ø§Ù… ÙŠØ§ Ø¨Ø±Ù†Ø³",

                importSuccess: "âœ… Ø±Ø¬Ø¹Ù†Ø§ Ø§Ù„ÙƒØªØ¨ ÙŠØ§ ÙˆØ­Ø´",

                defaultSecQ: "Ø·ÙˆÙ„Ùƒ ÙƒØ§Ù… ÙŠØ§ Ø¹Ù… Ø§Ù„Ø·ÙˆÙŠÙ„ØŸ"

            },

            "ar": {

                // Add Fusha translations if needed

            },

            "en": {

                // Add English translations if needed

            }

        };

        

        function init() {

            const mode = localStorage.getItem('ziadMode');

            if (!mode) {

                showPage('welcomePage');

            } else if (mode === 'password') {

                showPage('loginPage');

                checkFirstVisit();

            } else {

                enterLibrary();

            }

            setTheme(localStorage.getItem('ziadTheme') || 'dark');

            setLanguage(localStorage.getItem('ziadLang') || 'ar-EG');

            updateStats();

            document.getElementById('loader').style.display = 'none';

            document.getElementById('settingsBtn').style.display = 'block';

            document.getElementById('downloadBtn').style.display = 'block';

            document.getElementById('themeToggle').style.display = 'block';

        }

        

        function setTheme(theme) {

            document.body.setAttribute('data-theme', theme);

            localStorage.setItem('ziadTheme', theme);

        }

        

        function toggleTheme() {

            const current = document.body.getAttribute('data-theme');

            setTheme(current === 'dark' ? 'light' : 'dark');

        }

        

        function setLanguage(lang) {

            document.body.setAttribute('data-lang', lang);

            localStorage.setItem('ziadLang', lang);

            applyTranslations(lang);

            render();

        }

        

        function applyTranslations(lang) {

            document.querySelectorAll('[data-i18n]').forEach(el => {

                el.innerText = translations[lang][el.dataset.i18n] || el.innerText;

            });

            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {

                el.placeholder = translations[lang][el.dataset.i18nPlaceholder] || el.placeholder;

            });

        }

        

        function showPage(pageId) {

            ['welcomePage', 'loginPage', 'secPage', 'libraryContent'].forEach(p => {

                document.getElementById(p).style.display = p === pageId ? 'block' : 'none';

            });

        }

        

        function checkFirstVisit() {

            if (!localStorage.getItem('ziadPass')) {

                document.getElementById('loginDesc').style.display = 'block';

                document.getElementById('secSetup').style.display = 'block';

                document.getElementById('forgotPassLink').style.display = 'none';

                document.getElementById('loginTitle').innerText = translations[document.body.getAttribute('data-lang')].welcomeMsg;

            }

        }

        

        function handleAuth() {

            const pass = document.getElementById('passIn').value;

            if (!pass) return showToast(translations[document.body.getAttribute('data-lang')].errorEmpty);

            

            if (!localStorage.getItem('ziadPass')) {

                const secQ = document.getElementById('secQuestion').value;

                const secA = document.getElementById('secAnswer').value;

                if (!secQ || !secA) return showToast(translations[document.body.getAttribute('data-lang')].errorSec);

                

                localStorage.setItem('ziadPass', btoa(pass));

                localStorage.setItem('ziadSecQ', btoa(secQ));

                localStorage.setItem('ziadSecA', btoa(secA));

                enterLibrary();

            } else {

                if (btoa(pass) === localStorage.getItem('ziadPass')) {

                    enterLibrary();

                } else {

                    showToast(translations[document.body.getAttribute('data-lang')].errorWrongPass);

                }

            }

        }

        

        function enterLibrary() {

            showPage('libraryContent');

            showToast(translations[document.body.getAttribute('data-lang')].libraryWelcome);

            render();

        }

        

        function openSettings() {

            document.getElementById('settingsModal').style.display = 'block';

            document.getElementById('themeSelect').value = document.body.getAttribute('data-theme');

            document.getElementById('langSelect').value = document.body.getAttribute('data-lang');

        }

        

        function openChangePassModal() {

            closeModals();

            document.getElementById('changePassModal').style.display = 'block';

        }

        

        function saveNewPassAndSec() {

            const newPass = document.getElementById('newPassInput').value;

            const newSecQ = document.getElementById('newSecQuestion').value;

            const newSecA = document.getElementById('newSecAnswer').value;

            

            if (!newPass || !newSecQ || !newSecA) return showToast(translations[document.body.getAttribute('data-lang')].errorFillAll);

            

            localStorage.setItem('ziadPass', btoa(newPass));

            localStorage.setItem('ziadSecQ', btoa(newSecQ));

            localStorage.setItem('ziadSecA', btoa(newSecA));

            closeModals();

            showToast(translations[document.body.getAttribute('data-lang')].passChanged);

        }

        

        function deleteAllBooks() {

            if (confirm(translations[document.body.getAttribute('data-lang')].confirmDeleteAll)) {

                db.transaction("books", "readwrite").objectStore("books").clear().onsuccess = () => {

                    render();

                    updateStats();

                    showToast(translations[document.body.getAttribute('data-lang')].allDeleted);

                };

            }

        }

        

        function checkSec() {

            const ans = document.getElementById('secAns').value;

            if (btoa(ans) === localStorage.getItem('ziadSecA')) {

                showToast(translations[document.body.getAttribute('data-lang')].secSuccess);

                enterLibrary();

            } else {

                showToast(translations[document.body.getAttribute('data-lang')].secError);

            }

        }

        

        function openAboutModal() {

            closeModals();

            document.getElementById('aboutModal').style.display = 'block';

        }

        

        function openContactModal() {

            closeModals();

            document.getElementById('contactModal').style.display = 'block';

        }

        

        function closeModals() {

            document.querySelectorAll('.modal').forEach(m => m.style.display = 'none');

        }

        

        function showToast(msg) {

            const toast = document.getElementById('toast');

            toast.innerText = msg;

            toast.style.display = 'block';

            setTimeout(() => toast.style.display = 'none', 3000);

        }

        

        function playAudio(type) {

            // Add audio logic if needed

        }

        

        async function upload(e) {

            const file = e.target.files[0];

            if (!file || !file.name.endsWith('.pdf')) return;

            

            showToast(translations[document.body.getAttribute('data-lang')].uploading);

            

            const reader = new FileReader();

            reader.onload = async (ev) => {

                const { thumb, pages } = await getThumb(ev.target.result);

                

                const book = {

                    name: file.name.replace('.pdf', ''),

                    author: translations[document.body.getAttribute('data-lang')].defaultAuthor,

                    description: translations[document.body.getAttribute('data-lang')].defaultDesc,

                    category: 'Ø£Ø®Ø±Ù‰',

                    size: file.size,

                    data: ev.target.result,

                    thumb,

                    pages,

                    rating: 5

                };

                

                db.transaction("books", "readwrite").objectStore("books").add(book).onsuccess = () => {

                    render();

                    updateStats();

                    showToast(translations[document.body.getAttribute('data-lang')].uploadSuccess);

                };

            };

            reader.readAsDataURL(file);

        }

        

        async function getThumb(url) {

            try {

                const pdf = await pdfjsLib.getDocument(url).promise;

                const page = await pdf.getPage(1);

                const view = page.getViewport({ scale: 0.5 });

                const canv = document.createElement('canvas');

                canv.width = view.width; canv.height = view.height;

                await page.render({canvasContext: canv.getContext('2d'), viewport: view}).promise;

                return { thumb: canv.toDataURL('image/jpeg', 0.6), pages: pdf.numPages };

            } catch { return { thumb: '', pages: 0 }; }

        }

        

        function render() {

            const g = document.getElementById('grid');

            const q = document.getElementById('search').value.toLowerCase();

            const s = document.getElementById('sort').value;

            const cf = document.getElementById('catFilter').value;

            g.innerHTML = "";

            

            const tx = db.transaction("books", "readonly");

            let books = [];

            tx.objectStore("books").openCursor().onsuccess = (e) => {

                const c = e.target.result;

                if(c) { 

                    const v = c.value;

                    if((v.name.toLowerCase().includes(q) || (v.author && v.author.toLowerCase().includes(q))) && (cf === 'all' || v.category === cf)) books.push(v); 

                    c.continue(); 

                } else {

                    books.sort((a,b) => s === 'az' ? a.name.localeCompare(b.name) : b.id - a.id);

                    books.forEach(b => {

                        const d = document.createElement('div'); d.className = 'card';

                        d.innerHTML = `

                            <div class="card-tag">${b.category || translations[document.body.getAttribute('data-lang')].defaultCat}</div>

                            <img src="${b.thumb || 'https://via.placeholder.com/150'}" class="preview" onclick="openBookInBrowser(${b.id})">

                            <div class="book-title">${b.name}</div>

                            <div class="book-author">ğŸ‘¤ ${b.author || translations[document.body.getAttribute('data-lang')].defaultAuthor}</div>

                            <div class="book-rating">${"â­".repeat(b.rating || 5)}</div>

                            <div class="book-meta">${b.pages ? b.pages+' ' + translations[document.body.getAttribute('data-lang')].pages : ''} | ${formatSize(b.size)}</div>

                            <div class="card-btns">

                                <button class="btn-s" style="background:var(--primary); color:#000" onclick="openBookInBrowser(${b.id})" data-i18n="read">Ù‚Ø±Ø§Ø¡Ø© ğŸ“–</button>

                                <button class="btn-s" style="background:#333" onclick="downB(${b.id})" data-i18n="download">Ø­Ù…Ù„ ğŸ‘‡</button>

                                <button class="btn-s btn-edit" onclick="openEdit(${b.id})" data-i18n="edit">Ø¸Ø¨Ø·Ù‡ âœï¸</button>

                                <button class="btn-s" style="background:var(--danger)" onclick="moveToBin(${b.id})" data-i18n="delete">Ø§Ø±Ù…ÙŠÙ‡ ğŸ—‘ï¸</button>

                            </div>`;

                        g.appendChild(d);

                    });

                    applyTranslations(document.body.getAttribute('data-lang')); // Re-apply for dynamic content

                }

            };

        }

        

        function openBookInBrowser(id) {

            playAudio('click');

            

            db.transaction("books").objectStore("books").get(id).onsuccess = (e) => {

                const book = e.target.result;

                if (!book || !book.data) {

                    showToast("âš ï¸ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!");

                    return;

                }

        

                // ØªØ­ÙˆÙŠÙ„ data URL Ø¥Ù„Ù‰ Blob

                const byteString = atob(book.data.split(',')[1]);

                const mimeString = book.data.split(',')[0].split(':')[1].split(';')[0];

                const ab = new ArrayBuffer(byteString.length);

                const ia = new Uint8Array(ab);

                

                for (let i = 0; i < byteString.length; i++) {

                    ia[i] = byteString.charCodeAt(i);

                }

                

                const blob = new Blob([ab], { type: mimeString || 'application/pdf' });

                const url = URL.createObjectURL(blob);

        

                // ÙØªØ­ ÙÙŠ ØªØ¨ÙˆÙŠØ¨ Ø¬Ø¯ÙŠØ¯

                window.open(url, '_blank');

        

                // Ø§Ø®ØªÙŠØ§Ø±ÙŠ: ØªØ­Ø±ÙŠØ± Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ø¹Ø¯ ÙØªØ±Ø© Ù„ØªÙˆÙÙŠØ± Ø§Ù„Ø°Ø§ÙƒØ±Ø©

                setTimeout(() => URL.revokeObjectURL(url), 60000);

            };

        }

        

        function dataURLtoBlob(dataurl) {

            var arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1],

                bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);

            while(n--) u8arr[n] = bstr.charCodeAt(n);

            return new Blob([u8arr], {type:mime});

        }

        

        function openEdit(id) {

            db.transaction("books").objectStore("books").get(id).onsuccess = (e) => {

                const b = e.target.result;

                document.getElementById('editBookId').value = b.id;

                document.getElementById('editName').value = b.name;

                document.getElementById('editAuthor').value = b.author || '';

                document.getElementById('editCat').value = b.category;

                document.getElementById('editDesc').value = b.description || '';

                document.getElementById('editModal').style.display = 'block';

            };

        }

        

        function saveEdit() {

            const id = Number(document.getElementById('editBookId').value);

            const tx = db.transaction("books", "readwrite");

            const store = tx.objectStore("books");

            store.get(id).onsuccess = (e) => {

                const data = e.target.result;

                data.name = document.getElementById('editName').value;

                data.author = document.getElementById('editAuthor').value;

                data.category = document.getElementById('editCat').value;

                data.description = document.getElementById('editDesc').value;

                store.put(data);

                tx.oncomplete = () => { playAudio('success'); closeModals(); render(); showToast(translations[document.body.getAttribute('data-lang')].editSaved); };

            };

        }

        

        function downB(id) {

            playAudio('click');

            showToast(translations[document.body.getAttribute('data-lang')].downloading);

            db.transaction("books").objectStore("books").get(id).onsuccess = (e) => {

                const b = e.target.result;

                const a = document.createElement('a'); a.href = b.data; a.download = b.name + ".pdf"; a.click();

            };

        }

        

        function moveToBin(id) {

            playAudio('trash');

            const tx = db.transaction(["books", "bin"], "readwrite");

            tx.objectStore("books").get(id).onsuccess = (e) => {

                tx.objectStore("bin").add(e.target.result);

                tx.objectStore("books").delete(id);

                tx.oncomplete = () => { render(); updateStats(); showToast(translations[document.body.getAttribute('data-lang')].movedToBin); };

            };

        }

        

        function showBin() {

            const list = document.getElementById('binList'); list.innerHTML = "";

            document.getElementById('binModal').style.display = 'block';

            db.transaction("bin").objectStore("bin").openCursor().onsuccess = (e) => {

                const c = e.target.result;

                if(c) {

                    const row = document.createElement('div'); row.style = "display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #333; align-items:center";

                    row.innerHTML = `<span style="font-size:0.9rem">${c.value.name}</span> <button class="btn-s" style="background:#198754; padding:5px 10px" onclick="restoreBook(${c.value.id})" data-i18n="restore">${translations[document.body.getAttribute('data-lang')].restore}</button>`;

                    list.appendChild(row); c.continue();

                }

            };

        }

        

        function restoreBook(id) {

            playAudio('success');

            const tx = db.transaction(["books", "bin"], "readwrite");

            tx.objectStore("bin").get(id).onsuccess = (e) => {

                tx.objectStore("books").add(e.target.result);

                tx.objectStore("bin").delete(id);

                tx.oncomplete = () => { showBin(); render(); updateStats(); showToast(translations[document.body.getAttribute('data-lang')].restored); };

            };

        }

        

        function emptyBin() {

            if(confirm(translations[document.body.getAttribute('data-lang')].confirmEmptyBin)) {

                playAudio('trash');

                db.transaction("bin", "readwrite").objectStore("bin").clear().onsuccess = () => {

                    closeModals(); updateStats(); showToast(translations[document.body.getAttribute('data-lang')].binEmptied);

                };

            }

        }

        

        function updateStats() {

            let total = 0;

            const tx = db.transaction(["books", "bin"], "readonly");

            tx.objectStore("books").openCursor().onsuccess = (e) => {

                const c = e.target.result;

                if(c) { total += (c.value.size || 0); c.continue(); }

                else document.getElementById('totalStorage').innerText = formatSize(total);

            };

            tx.objectStore("bin").count().onsuccess = (e) => document.getElementById('binCount').innerText = e.target.result;

        }

        

        function formatSize(bytes) {

            if(!bytes) return '0 B';

            const i = Math.floor(Math.log(bytes) / Math.log(1024));

            return (bytes / Math.pow(1024, i)).toFixed(1) + ' ' + ['B', 'KB', 'MB', 'GB'][i];

        }

        

        function exportData() {

            const tx = db.transaction("books", "readonly");

            const data = [];

            tx.objectStore("books").openCursor().onsuccess = (e) => {

                const c = e.target.result;

                if(c) { data.push(c.value); c.continue(); }

                else {

                    const a = document.createElement('a');

                    a.href = URL.createObjectURL(new Blob([JSON.stringify(data)], {type: "application/json"}));

                    a.download = "Ziad_Library_Backup.json"; a.click();

                }

            };

        }

        

        function importData(e) {

            const reader = new FileReader();

            reader.onload = (ev) => {

                const data = JSON.parse(ev.target.result);

                const tx = db.transaction("books", "readwrite");

                data.forEach(item => tx.objectStore("books").add(item));

                tx.oncomplete = () => { playAudio('success'); render(); updateStats(); showToast(translations[document.body.getAttribute('data-lang')].importSuccess); };

            };

            reader.readAsText(e.target.files[0]);

        }

        

        function choosePasswordMode() {

            localStorage.setItem('ziadMode', 'password');

            showPage('loginPage');

            checkFirstVisit();

        }

        

        function chooseNoPasswordMode() {

            localStorage.setItem('ziadMode', 'noPassword');

            enterLibrary();

        }

        

        init();

    </script>

</body>

</html>