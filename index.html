<!DOCTYPE html>

<html lang="ar" dir="rtl">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Ù…ÙƒØªØ¨Ø© Ziad Aldriny 2026 - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø·ÙˆØ±Ù‘Ø©</title>

    

    <meta name="theme-color" content="#050505">

    <meta name="apple-mobile-web-app-capable" content="yes">

    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="apple-mobile-web-app-title" content="Ziad Library">

    <link rel="apple-touch-icon" href="favicon.png">

    

    <link rel="manifest" href="manifest.json">

    <link rel="icon" type="image/png" href="favicon.png">

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;600;900&display=swap" rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>

    

    <style>

        :root {

            --primary: #00d4ff; --bg: #050505; --card: #0d1117;

            --text: #ffffff; --border: rgba(255,255,255,0.1); --danger: #ff4d4d;

            --success: #2ecc71;

        }

        [data-theme="light"] { --bg: #f0f2f5; --card: #ffffff; --text: #1a1a1a; --primary: #007bff; --border: rgba(0,0,0,0.1); }

        [data-theme="purple"] { --bg: #1a0b2e; --card: #2d1454; --text: #ffffff; --primary: #bc13fe; --border: rgba(255,255,255,0.1); }

        [data-theme="forest"] { --bg: #0a1a0a; --card: #142d14; --text: #ffffff; --primary: #2ecc71; --border: rgba(255,255,255,0.1); }

        [data-theme="sunset"] { --bg: #1a0f0f; --card: #2d1414; --text: #ffffff; --primary: #e67e22; --border: rgba(255,255,255,0.1); }

        [data-theme="gold"] { --bg: #11110a; --card: #222214; --text: #ffffff; --primary: #f1c40f; --border: rgba(255,255,255,0.1); }

        

        * { box-sizing: border-box; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); }

        body { font-family: 'Cairo', sans-serif; background: var(--bg); color: var(--text); margin: 0; min-height: 100vh; overflow-x: hidden; }

        .floating-badge {

            position: fixed; bottom: 20px; right: 20px;

            background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px);

            border: 1px solid var(--primary); color: var(--primary);

            padding: 10px 20px; border-radius: 50px; font-weight: 900;

            box-shadow: 0 0 20px rgba(0, 212, 255, 0.3); z-index: 9999;

            animation: pulse 2s infinite, float 3s ease-in-out infinite; display: none;

        }

        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(0,212,255,0.4); } 70% { box-shadow: 0 0 0 15px rgba(0,212,255,0); } }

        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        

        #loader { position: fixed; inset: 0; background: #000; display: flex; justify-content: center; align-items: center; z-index: 10000; }

        .spinner { width: 50px; height: 50px; border: 5px solid #111; border-top-color: var(--primary); border-radius: 50%; animation: spin 0.8s infinite ease-in-out; }

        @keyframes spin { to { transform: rotate(360deg); } }

        .header { text-align: center; padding: 30px 0; position: relative; }

        #settingsBtn { display: none; position: absolute; top: 15px; left: 15px; z-index: 100; }

        .user-logo { width: 100px; height: 100px; border-radius: 20px; border: 2px solid var(--primary); box-shadow: 0 0 20px var(--primary); object-fit: cover; }

        .ziad-name { font-size: 2rem; font-weight: 900; text-shadow: 0 0 15px var(--primary); margin: 10px 0; }

        

        .glass-panel { background: rgba(255,255,255,0.03); backdrop-filter: blur(15px); border: 1px solid var(--border); border-radius: 25px; padding: 35px; width: 90%; max-width: 400px; margin: 40px auto; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }

        input, select, textarea { width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; border: 1px solid var(--border); background: rgba(0,0,0,0.3); color: var(--text); text-align: center; font-family: 'Cairo'; outline: none; }

        input:focus, textarea:focus { border-color: var(--primary); box-shadow: 0 0 10px var(--primary); }

        

        .btn { background: linear-gradient(45deg, #0056b3, var(--primary)); color: white; border: none; padding: 12px; border-radius: 10px; font-weight: 700; cursor: pointer; width: 100%; font-size: 1rem; }

        .btn:hover { transform: translateY(-3px); box-shadow: 0 8px 20px var(--primary); }

        

        #libraryContent { display: none; padding: 20px; max-width: 1300px; margin: auto; animation: fadeIn 0.5s ease; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        

        .top-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; gap: 15px; flex-wrap: wrap; }

        .status-chip { background: var(--card); padding: 8px 16px; border-radius: 50px; border: 1px solid var(--primary); cursor: pointer; font-size: 0.85rem; display: flex; align-items: center; gap: 8px; font-weight: bold; }

        .status-chip:hover { background: var(--primary); color: #000; }

        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: none; z-index: 2000; padding: 20px; backdrop-filter: blur(5px); }

        .modal-box { background: var(--card); max-width: 500px; margin: 30px auto; padding: 25px; border-radius: 25px; border: 1px solid var(--primary); position: relative; max-height: 90vh; overflow-y: auto; }

        #readerModal .modal-box { max-width: 90%; height: 90vh; display: flex; flex-direction: column; padding: 10px; }

        #pdfFrame { flex-grow: 1; border: none; border-radius: 10px; background: #fff; }

        .controls { display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 12px; background: var(--card); padding: 15px; border-radius: 15px; margin-bottom: 30px; border: 1px solid var(--border); }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }

        

        .card { background: var(--card); border-radius: 20px; padding: 12px; border: 1px solid var(--border); position: relative; overflow: hidden; display: flex; flex-direction: column; }

        .card:hover { transform: translateY(-10px); border-color: var(--primary); box-shadow: 0 10px 20px rgba(0,0,0,0.4); }

        .card-tag { position: absolute; top: 12px; right: 12px; background: var(--primary); color: #000; font-size: 0.7rem; padding: 4px 10px; border-radius: 8px; font-weight: 900; z-index: 5; }

        .preview { width: 100%; aspect-ratio: 3/4; border-radius: 12px; object-fit: cover; background: #111; cursor: pointer; }

        

        .book-title { font-weight: 900; color: var(--primary); text-align: center; margin: 10px 0 5px 0; font-size: 1.1rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        .book-author { font-size: 0.85rem; color: #ccc; text-align: center; margin-bottom: 5px; font-weight: 600; }

        .book-meta { font-size: 0.7rem; color: #777; margin-bottom: 10px; text-align: center; display: flex; justify-content: center; gap: 10px; }

        .card-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: auto; }

        .btn-s { padding: 8px; border-radius: 8px; border: none; font-weight: bold; font-size: 0.8rem; cursor: pointer; color: #fff; transition:0.2s; }

        .btn-edit { background: rgba(255,255,255,0.1); color: var(--primary); border: 1px solid var(--primary); grid-column: span 2; }

        

        .book-rating { color: #f1c40f; font-size: 0.9rem; margin-bottom: 5px; text-align: center; }

        #toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: var(--primary); color: #000; padding: 12px 30px; border-radius: 15px; font-weight: 800; display: none; z-index: 5000; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }

        

        @media (max-width: 600px) {

            .grid { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; }

            .controls { grid-template-columns: 1fr; }

        }

        .footer { text-align: center; padding: 40px; color: #666; font-size: 0.9rem; font-weight: bold; }

    </style>

</head>

<body data-theme="dark">

    <div id="loader"><div class="spinner"></div></div>

    <div class="floating-badge" id="floatingBadge">Ziad # 1</div>

    

    <div class="header">

        <div id="settingsBtn">

            <button class="status-chip" onclick="playAudio('click'); openSettings()">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>

        </div>

        <img src="favicon.png" class="user-logo" onerror="this.src='https://cdn-icons-png.flaticon.com/512/1043/1043322.png'">

        <div class="ziad-name">Ziad Library <span style="font-size:1rem; vertical-align:middle; color:var(--primary)">Pro</span></div>

    </div>

    <div id="loginPage" class="glass-panel">

        <h2 id="loginTitle" style="color:var(--primary); margin-top:0">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ø¨Ø·Ù„ ğŸŒ€</h2>

        <p id="loginDesc" style="font-size:0.9rem; color:#aaa; margin-bottom:15px; display:none">ÙŠØ¨Ø¯Ùˆ Ø£Ù† Ù‡Ø°Ù‡ Ø²ÙŠØ§Ø±ØªÙƒ Ø§Ù„Ø£ÙˆÙ„Ù‰ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù„Ù„Ù…ÙƒØªØ¨Ø©:</p>

        <input type="password" id="passIn" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">

        <button id="loginBtn" class="btn" onclick="handleAuth()">Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…ÙƒØªØ¨Ø©</button>

        <p id="forgotPassLink" onclick="playAudio('click'); showPage('secPage')" style="cursor:pointer; font-size:0.8rem; margin-top:20px; color:#555">Ù‡Ù„ Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ</p>

    </div>

    <div id="secPage" class="glass-panel" style="display:none">

        <h3 style="color:var(--primary)">Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø³Ø§Ø¨</h3>

        <p style="font-size:0.9rem">Ù…Ø§ Ù‡Ùˆ Ø·ÙˆÙ„ÙƒØŸ (Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£Ù…Ø§Ù†)</p>

        <input type="text" id="secAns" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ù‡Ù†Ø§">

        <button class="btn" onclick="checkSec()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù‡ÙˆÙŠØ©</button>

        <button class="btn" style="background:transparent; color:#777; margin-top:10px" onclick="playAudio('click'); showPage('loginPage')">Ø±Ø¬ÙˆØ¹</button>

    </div>

    <div id="libraryContent">

        <div class="top-nav">

            <div style="display:flex; gap:10px">

                <div class="status-chip" onclick="playAudio('popup');" id="storageChip">ğŸ’¾ Ø§Ù„Ù…Ø³Ø§Ø­Ø©: <span id="totalStorage">0 KB</span></div>

                <div class="status-chip" onclick="playAudio('trash'); showBin()" style="border-color:var(--danger); color:var(--danger)">ğŸ—‘ï¸ Ø§Ù„Ù…Ø­Ø°ÙˆÙØ§Øª (<span id="binCount">0</span>)</div>

            </div>

            <div style="display:flex; gap:10px">

                <button class="status-chip" style="background:#198754; color:#fff; border:none" onclick="playAudio('success'); exportData()">ğŸ“¤ ØªØµØ¯ÙŠØ±</button>

                <button class="status-chip" style="background:#6f42c1; color:#fff; border:none" onclick="playAudio('click'); document.getElementById('importFile').click()">ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>

                <input type="file" id="importFile" accept=".json" style="display:none" onchange="importData(event)">

            </div>

        </div>

        <div class="controls">

            <input type="text" id="search" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„ÙƒØªØ§Ø¨ Ø£Ùˆ Ø§Ù„Ù…Ø¤Ù„Ù..." oninput="render()">

            <select id="catFilter" onchange="playAudio('click'); render()">

                <option value="all">ğŸ“ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</option>

                <option value="ÙƒØªØ¨">ğŸ“š ÙƒØªØ¨</option>

                <option value="Ø±ÙˆØ§ÙŠØ§Øª">ğŸ­ Ø±ÙˆØ§ÙŠØ§Øª</option>

                <option value="Ù…Ù„Ø®ØµØ§Øª">ğŸ“ Ù…Ù„Ø®ØµØ§Øª</option>

                <option value="Ø£Ø®Ø±Ù‰">âœ¨ Ø£Ø®Ø±Ù‰</option>

            </select>

            <select id="sort" onchange="playAudio('click'); render()">

                <option value="new">ğŸ•’ Ø§Ù„Ø£Ø­Ø¯Ø«</option>

                <option value="az">ğŸ”¤ Ø£Ø¨Ø¬Ø¯ÙŠ</option>

            </select>

            <button class="btn" onclick="playAudio('popup'); document.getElementById('fileIn').click()">â• Ø±ÙØ¹ PDF</button>

            <input type="file" id="fileIn" accept=".pdf" style="display:none" onchange="upload(event)">

        </div>

        <div class="grid" id="grid"></div>

    </div>

    <div id="settingsModal" class="modal"><div class="modal-box">

        <h4 style="color:var(--primary); margin-top:0">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª âš™ï¸</h4>

        <label>Ø§Ù„Ù…Ø¸Ù‡Ø±:</label>

        <select id="themeSelect" onchange="playAudio('click'); setTheme(this.value)">

            <option value="dark">Ø¯Ø§ÙƒÙ†</option><option value="light">ÙØ§ØªØ­</option><option value="purple">Ø¨Ù†ÙØ³Ø¬ÙŠ</option><option value="forest">Ø§Ù„ØºØ§Ø¨Ø©</option><option value="sunset">ØºØ±ÙˆØ¨ Ø§Ù„Ø´Ù…Ø³</option><option value="gold">Ø§Ù„Ø°Ù‡Ø¨ÙŠ</option>

        </select>

        <label style="display:block; margin-top:20px;">ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</label>

        <input type="text" id="newPassInput" placeholder="ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¬Ø¯ÙŠØ¯Ø©">

        <button class="btn" onclick="playAudio('success'); saveNewPass()">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button>

        <button class="btn" style="background:#333; margin-top:15px" onclick="playAudio('click'); closeModals()">Ø¥ØºÙ„Ø§Ù‚</button>

    </div></div>

    <div id="uploadModal" class="modal"><div class="modal-box">

        <h4 style="color:var(--primary)">Ø¥Ø¶Ø§ÙØ© ÙƒØªØ§Ø¨ Ø¬Ø¯ÙŠØ¯</h4>

        <div id="pendingFileName" style="font-size:0.8rem; color:#888; margin-bottom:10px"></div>

        <label>Ø§Ø³Ù… Ø§Ù„ÙƒØªØ§Ø¨:</label>

        <input type="text" id="bookNameInput" placeholder="Ø§Ø³Ù… Ø§Ù„ÙƒØªØ§Ø¨">

        <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø¤Ù„Ù:</label>

        <input type="text" id="authorInput" placeholder="Ù…Ø«Ø§Ù„: Ø¯. Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø§Ù„ÙÙ‚ÙŠ">

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px">

            <div>

                <label>Ø§Ù„ØªØµÙ†ÙŠÙ:</label>

                <select id="selectedCat"><option value="ÙƒØªØ¨">ÙƒØªØ¨</option><option value="Ø±ÙˆØ§ÙŠØ§Øª">Ø±ÙˆØ§ÙŠØ§Øª</option><option value="Ù…Ù„Ø®ØµØ§Øª">Ù…Ù„Ø®ØµØ§Øª</option><option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option></select>

            </div>

            <div>

                <label>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</label>

                <select id="bookRatingInput">

                    <option value="5">â­â­â­â­â­</option><option value="4">â­â­â­â­</option><option value="3">â­â­â­</option><option value="2">â­â­</option><option value="1">â­</option>

                </select>

            </div>

        </div>

        <label>ÙˆØµÙ Ø§Ù„ÙƒØªØ§Ø¨:</label>

        <textarea id="bookDescInput" rows="3" placeholder="Ù†Ø¨Ø°Ø© Ù…Ø®ØªØµØ±Ø© Ø¹Ù† Ø§Ù„ÙƒØªØ§Ø¨..."></textarea>

        <button class="btn" id="confirmUploadBtn">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø±ÙØ¹</button>

        <button class="btn" style="background:#333; margin-top:10px" onclick="playAudio('click'); closeModals()">Ø¥Ù„ØºØ§Ø¡</button>

    </div></div>

    <div id="editModal" class="modal"><div class="modal-box">

        <h4 style="color:var(--primary)">ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØªØ§Ø¨</h4>

        <input type="hidden" id="editBookId">

        <label>Ø§Ø³Ù… Ø§Ù„ÙƒØªØ§Ø¨:</label>

        <input type="text" id="editName">

        <label>Ø§Ù„Ù…Ø¤Ù„Ù:</label>

        <input type="text" id="editAuthor">

        <label>Ø§Ù„ØªØµÙ†ÙŠÙ:</label>

        <select id="editCat"><option value="ÙƒØªØ¨">ÙƒØªØ¨</option><option value="Ø±ÙˆØ§ÙŠØ§Øª">Ø±ÙˆØ§ÙŠØ§Øª</option><option value="Ù…Ù„Ø®ØµØ§Øª">Ù…Ù„Ø®ØµØ§Øª</option><option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option></select>

        <label>Ø§Ù„ÙˆØµÙ:</label>

        <textarea id="editDesc" rows="3"></textarea>

        <button class="btn" onclick="saveEdit()">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>

        <button class="btn" style="background:#333; margin-top:10px" onclick="closeModals()">Ø¥Ù„ØºØ§Ø¡</button>

    </div></div>

    <div id="readerModal" class="modal">

        <div class="modal-box">

            <div style="display:flex; justify-content:space-between; margin-bottom:10px">

                <span style="font-weight:bold" id="readerTitle">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ÙƒØªØ§Ø¨</span>

                <button onclick="closeModals()" style="background:none; border:none; color:var(--danger); cursor:pointer; font-size:1.2rem">âœ– Ø¥ØºÙ„Ø§Ù‚</button>

            </div>

            <iframe id="pdfFrame"></iframe>

        </div>

    </div>

    <div id="binModal" class="modal"><div class="modal-box">

        <h4 style="color:var(--danger)">Ø³Ù„Ø© Ø§Ù„Ù…Ø­Ø°ÙˆÙØ§Øª</h4>

        <div id="binList"></div>

        <button class="btn" style="background:var(--danger)" onclick="emptyBin()">Ø¥ÙØ±Ø§Øº Ø§Ù„ÙƒÙ„</button>

        <button class="btn" style="background:#333; margin-top:10px" onclick="playAudio('click'); closeModals()">Ø¥ØºÙ„Ø§Ù‚</button>

    </div></div>

    <div id="toast"></div>

    <div class="footer">Ø¨ÙˆØ§Ø³Ø·Ø© Ziad Library Pro &copy; 2026</div>

    <script>

        if ('serviceWorker' in navigator) {

            window.addEventListener('load', () => {

                const swCode = `

                    const CACHE_NAME = 'ziad-lib-v1';

                    self.addEventListener('install', e => e.waitUntil(caches.open(CACHE_NAME).then(c => c.addAll(['/']))));

                    self.addEventListener('fetch', e => e.respondWith(caches.match(e.request).then(r => r || fetch(e.request))));

                `;

                const blob = new Blob([swCode], { type: 'text/javascript' });

                const swUrl = URL.createObjectURL(blob);

                navigator.serviceWorker.register(swUrl).catch(console.error);

            });

        }

        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

        

        const sounds = {

            click: "https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3",

            success: "https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3",

            trash: "https://assets.mixkit.co/active_storage/sfx/2570/2570-preview.mp3",

            error: "https://assets.mixkit.co/active_storage/sfx/2572/2572-preview.mp3",

            popup: "https://assets.mixkit.co/active_storage/sfx/2580/2580-preview.mp3",

            engine: "https://assets.mixkit.co/active_storage/sfx/876/876-preview.mp3"

        };

        

        function playAudio(type) {

            const audio = new Audio(sounds[type]);

            audio.volume = 0.5;

            audio.play().catch(e => console.log("Audio blocked"));

        }

        let db;

        // Ø¬Ù„Ø¨ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø®Ø²Ù†Ø© (Ø³ØªÙƒÙˆÙ† null ÙÙŠ Ø£ÙˆÙ„ Ù…Ø±Ø©)

        let currentPass = localStorage.getItem('ziadPass');

        let pendingFile = null;

        const init = () => {

            const theme = localStorage.getItem('ziadTheme') || 'dark';

            document.body.setAttribute('data-theme', theme);

            checkFirstVisit(); // ÙØ­Øµ Ø§Ù„Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰

        };

        // Ø¯Ø§Ù„Ø© Ù„ÙØ­Øµ Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯Ø§Ù‹

        function checkFirstVisit() {

            const title = document.getElementById('loginTitle');

            const desc = document.getElementById('loginDesc');

            const btn = document.getElementById('loginBtn');

            const forgot = document.getElementById('forgotPassLink');

            if (!currentPass) {

                title.innerText = "Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ âœ¨";

                desc.style.display = "block";

                btn.innerText = "Ø­ÙØ¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙˆØ§Ù„Ø¯Ø®ÙˆÙ„";

                forgot.style.display = "none";

            }

        }

        // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£Ùˆ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡

        function handleAuth() {

            const inputVal = document.getElementById('passIn').value;

            if (!inputVal) {

                showToast("âš ï¸ ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±");

                return;

            }

            if (!currentPass) {

                // Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù„Ø£ÙˆÙ„ Ù…Ø±Ø©

                localStorage.setItem('ziadPass', inputVal);

                currentPass = inputVal;

                playAudio('success');

                showToast("âœ… ØªÙ… ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­");

                enterLibrary();

            } else {

                // ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø¹Ø§Ø¯ÙŠ

                if (inputVal === currentPass) {

                    enterLibrary();

                } else {

                    playAudio('error');

                    showToast("âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø·Ø£");

                }

            }

        }

        function enterLibrary() {

            playAudio('engine');

            showPage('libraryContent');

            render();

        }

        function setTheme(val) {

            localStorage.setItem('ziadTheme', val);

            document.body.setAttribute('data-theme', val);

        }

        function openSettings() { playAudio('popup'); document.getElementById('settingsModal').style.display='block'; }

        function saveNewPass() {

            const np = document.getElementById('newPassInput').value;

            if(np) {

                localStorage.setItem('ziadPass', np);

                currentPass = np;

                showToast("âœ… ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±");

                document.getElementById('newPassInput').value = '';

            }

        }

        const req = indexedDB.open("Ziad_Library_Pro_2026", 2);

        req.onupgradeneeded = (e) => {

            const d = e.target.result;

            if(!d.objectStoreNames.contains("books")) d.createObjectStore("books", {keyPath: "id", autoIncrement: true});

            if(!d.objectStoreNames.contains("bin")) d.createObjectStore("bin", {keyPath: "id", autoIncrement: true});

        };

        req.onsuccess = (e) => { 

            db = e.target.result; 

            updateStats();

            setTimeout(() => document.getElementById('loader').style.display='none', 800);

        };

        function showToast(m) {

            const t = document.getElementById('toast'); t.innerText = m;

            t.style.display = 'block'; setTimeout(() => t.style.display = 'none', 3000);

        }

        function showPage(id) {

            ['loginPage', 'secPage', 'libraryContent'].forEach(p => document.getElementById(p).style.display = 'none');

            document.getElementById(id).style.display = 'block';

            const sBtn = document.getElementById('settingsBtn');

            const fBadge = document.getElementById('floatingBadge');

            if (id === 'libraryContent') { sBtn.style.display = 'block'; fBadge.style.display = 'block'; }

            else { sBtn.style.display = 'none'; fBadge.style.display = 'none'; }

        }

        function checkSec() {

            if(document.getElementById('secAns').value === "Ù…Ø¹Ø±ÙØ´") {

                playAudio('engine');

                showPage('libraryContent'); 

                showToast("Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒ!"); 

                render();

            } else {

                playAudio('error');

                showToast("âš ï¸ Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø·Ø£");

            }

        }

        function closeModals() { 

            document.querySelectorAll('.modal').forEach(m => m.style.display='none'); 

            document.getElementById('pdfFrame').src = "";

        }

        function upload(e) {

            pendingFile = e.target.files[0];

            if(!pendingFile) return;

            playAudio('popup');

            document.getElementById('pendingFileName').innerText = pendingFile.name;

            document.getElementById('bookNameInput').value = pendingFile.name.replace('.pdf','');

            document.getElementById('uploadModal').style.display = 'block';

        }

        document.getElementById('confirmUploadBtn').onclick = async () => {

            const name = document.getElementById('bookNameInput').value;

            const author = document.getElementById('authorInput').value || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";

            const cat = document.getElementById('selectedCat').value;

            const desc = document.getElementById('bookDescInput').value || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ";

            const rating = document.getElementById('bookRatingInput').value;

            const file = pendingFile;

            

            closeModals();

            showToast("â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙƒØªØ§Ø¨ ÙˆØ§Ù„Ø±ÙØ¹...");

            

            const r = new FileReader();

            r.onload = async (ev) => {

                const pdfData = ev.target.result;

                const pdfInfo = await getPdfInfo(pdfData);

                

                const tx = db.transaction("books", "readwrite");

                tx.objectStore("books").add({ 

                    name: name, author: author, data: pdfData, thumb: pdfInfo.thumb, 

                    pages: pdfInfo.pages, size: file.size, category: cat,

                    description: desc, rating: rating, date: new Date().toLocaleDateString('ar-EG') 

                });

                tx.oncomplete = () => { 

                    playAudio('success'); render(); updateStats(); showToast("âœ… ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…ÙƒØªØ¨Ø©"); 

                    document.getElementById('bookDescInput').value = ''; document.getElementById('authorInput').value = '';

                };

            };

            r.readAsDataURL(file);

        };

        async function getPdfInfo(data) {

            try {

                const pdf = await pdfjsLib.getDocument(data).promise;

                const page = await pdf.getPage(1);

                const canv = document.createElement('canvas');

                const view = page.getViewport({scale: 0.3});

                canv.width = view.width; canv.height = view.height;

                await page.render({canvasContext: canv.getContext('2d'), viewport: view}).promise;

                return { thumb: canv.toDataURL('image/jpeg', 0.6), pages: pdf.numPages };

            } catch { return { thumb: '', pages: 0 }; }

        }

        function render() {

            const g = document.getElementById('grid');

            const q = document.getElementById('search').value.toLowerCase();

            const s = document.getElementById('sort').value;

            const cf = document.getElementById('catFilter').value;

            g.innerHTML = "";

            

            const tx = db.transaction("books", "readonly");

            let books = [];

            tx.objectStore("books").openCursor().onsuccess = (e) => {

                const c = e.target.result;

                if(c) { 

                    const v = c.value;

                    if((v.name.toLowerCase().includes(q) || (v.author && v.author.toLowerCase().includes(q))) && (cf === 'all' || v.category === cf)) books.push(v); 

                    c.continue(); 

                } else {

                    books.sort((a,b) => s === 'az' ? a.name.localeCompare(b.name) : b.id - a.id);

                    books.forEach(b => {

                        const d = document.createElement('div'); d.className = 'card';

                        d.innerHTML = `

                            <div class="card-tag">${b.category || 'ÙƒØªØ¨'}</div>

                            <img src="${b.thumb || 'https://via.placeholder.com/150'}" class="preview" onclick="openReader(${b.id})">

                            <div class="book-title">${b.name}</div>

                            <div class="book-author">ğŸ‘¤ ${b.author || 'Ù…Ø¬Ù‡ÙˆÙ„'}</div>

                            <div class="book-rating">${"â­".repeat(b.rating || 5)}</div>

                            <div class="book-meta">${b.pages ? b.pages+' ØµÙØ­Ø©' : ''} | ${formatSize(b.size)}</div>

                            <div class="card-btns">

                                <button class="btn-s" style="background:var(--primary); color:#000" onclick="openReader(${b.id})">Ù‚Ø±Ø§Ø¡Ø©</button>

                                <button class="btn-s" style="background:#333" onclick="downB(${b.id})">ØªØ­Ù…ÙŠÙ„</button>

                                <button class="btn-s btn-edit" onclick="openEdit(${b.id})">ØªØ¹Ø¯ÙŠÙ„ âœï¸</button>

                                <button class="btn-s" style="background:var(--danger)" onclick="moveToBin(${b.id})">Ø­Ø°Ù</button>

                            </div>`;

                        g.appendChild(d);

                    });

                }

            };

        }

        function openReader(id) {

            playAudio('popup');

            db.transaction("books").objectStore("books").get(id).onsuccess = (e) => {

                const b = e.target.result;

                const blob = dataURLtoBlob(b.data);

                document.getElementById('pdfFrame').src = URL.createObjectURL(blob);

                document.getElementById('readerTitle').innerText = b.name;

                document.getElementById('readerModal').style.display = 'block';

            };

        }

        function dataURLtoBlob(dataurl) {

            var arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1],

                bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);

            while(n--) u8arr[n] = bstr.charCodeAt(n);

            return new Blob([u8arr], {type:mime});

        }

        function openEdit(id) {

            db.transaction("books").objectStore("books").get(id).onsuccess = (e) => {

                const b = e.target.result;

                document.getElementById('editBookId').value = b.id;

                document.getElementById('editName').value = b.name;

                document.getElementById('editAuthor').value = b.author || '';

                document.getElementById('editCat').value = b.category;

                document.getElementById('editDesc').value = b.description || '';

                document.getElementById('editModal').style.display = 'block';

            };

        }

        function saveEdit() {

            const id = Number(document.getElementById('editBookId').value);

            const tx = db.transaction("books", "readwrite");

            const store = tx.objectStore("books");

            store.get(id).onsuccess = (e) => {

                const data = e.target.result;

                data.name = document.getElementById('editName').value;

                data.author = document.getElementById('editAuthor').value;

                data.category = document.getElementById('editCat').value;

                data.description = document.getElementById('editDesc').value;

                store.put(data);

                tx.oncomplete = () => { playAudio('success'); closeModals(); render(); showToast("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª"); };

            };

        }

        function downB(id) {

            playAudio('click');

            db.transaction("books").objectStore("books").get(id).onsuccess = (e) => {

                const b = e.target.result;

                const a = document.createElement('a'); a.href = b.data; a.download = b.name + ".pdf"; a.click();

            };

        }

        function moveToBin(id) {

            playAudio('trash');

            const tx = db.transaction(["books", "bin"], "readwrite");

            tx.objectStore("books").get(id).onsuccess = (e) => {

                tx.objectStore("bin").add(e.target.result);

                tx.objectStore("books").delete(id);

                tx.oncomplete = () => { render(); updateStats(); showToast("ğŸ—‘ï¸ ØªÙ… Ø§Ù„Ù†Ù‚Ù„ Ù„Ù„Ø³Ù„Ø©"); };

            };

        }

        function showBin() {

            const list = document.getElementById('binList'); list.innerHTML = "";

            document.getElementById('binModal').style.display = 'block';

            db.transaction("bin").objectStore("bin").openCursor().onsuccess = (e) => {

                const c = e.target.result;

                if(c) {

                    const row = document.createElement('div'); row.style = "display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #333; align-items:center";

                    row.innerHTML = `<span style="font-size:0.9rem">${c.value.name}</span> <button class="btn-s" style="background:#198754; padding:5px 10px" onclick="restoreBook(${c.value.id})">Ø§Ø³ØªØ¹Ø§Ø¯Ø©</button>`;

                    list.appendChild(row); c.continue();

                }

            };

        }

        function restoreBook(id) {

            playAudio('success');

            const tx = db.transaction(["books", "bin"], "readwrite");

            tx.objectStore("bin").get(id).onsuccess = (e) => {

                tx.objectStore("books").add(e.target.result);

                tx.objectStore("bin").delete(id);

                tx.oncomplete = () => { showBin(); render(); updateStats(); };

            };

        }

        function emptyBin() {

            if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ø§Ù„Ø­Ø°Ù!")) {

                playAudio('trash');

                db.transaction("bin", "readwrite").objectStore("bin").clear().onsuccess = () => {

                    closeModals(); updateStats(); showToast("ØªÙ… Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ");

                };

            }

        }

        function updateStats() {

            let total = 0;

            const tx = db.transaction(["books", "bin"], "readonly");

            tx.objectStore("books").openCursor().onsuccess = (e) => {

                const c = e.target.result;

                if(c) { total += (c.value.size || 0); c.continue(); }

                else document.getElementById('totalStorage').innerText = formatSize(total);

            };

            tx.objectStore("bin").count().onsuccess = (e) => document.getElementById('binCount').innerText = e.target.result;

        }

        function formatSize(bytes) {

            if(!bytes) return '0 B';

            const i = Math.floor(Math.log(bytes) / Math.log(1024));

            return (bytes / Math.pow(1024, i)).toFixed(1) + ' ' + ['B', 'KB', 'MB', 'GB'][i];

        }

        function exportData() {

            const tx = db.transaction("books", "readonly");

            const data = [];

            tx.objectStore("books").openCursor().onsuccess = (e) => {

                const c = e.target.result;

                if(c) { data.push(c.value); c.continue(); }

                else {

                    const a = document.createElement('a');

                    a.href = URL.createObjectURL(new Blob([JSON.stringify(data)], {type: "application/json"}));

                    a.download = "Ziad_Library_Backup.json"; a.click();

                }

            };

        }

        function importData(e) {

            const reader = new FileReader();

            reader.onload = (ev) => {

                const data = JSON.parse(ev.target.result);

                const tx = db.transaction("books", "readwrite");

                data.forEach(item => tx.objectStore("books").add(item));

                tx.oncomplete = () => { playAudio('success'); render(); updateStats(); showToast("âœ… ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨Ù†Ø¬Ø§Ø­"); };

            };

            reader.readAsText(e.target.files[0]);

        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©

        init();

    </script>

</body>

</html>