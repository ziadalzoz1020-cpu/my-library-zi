<!DOCTYPE html>

<html lang="ar" dir="rtl">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Ù…ÙƒØªØ¨Ø© Ø²ÙŠØ§Ø¯ - Ø§Ù„Ø±ÙˆÙ‚Ø§Ù† ÙƒÙ„Ù‡ 2026 â˜•</title>

    

    <meta name="theme-color" content="#050505">

    <meta name="apple-mobile-web-app-capable" content="yes">

    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="apple-mobile-web-app-title" content="Ziad Library">

    <link rel="apple-touch-icon" href="favicon.png">

    

    <link rel="manifest" href="manifest.json">

    <link rel="icon" type="image/png" href="favicon.png">

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;600;900&display=swap" rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>

    

    <style>

        :root {

            --primary: #00d4ff; --bg: #050505; --card: #0d1117;

            --text: #ffffff; --border: rgba(255,255,255,0.1); --danger: #ff4d4d;

            --success: #2ecc71;

        }

        [data-theme="light"] { --bg: #f0f2f5; --card: #ffffff; --text: #1a1a1a; --primary: #007bff; --border: rgba(0,0,0,0.1); }

        [data-theme="purple"] { --bg: #1a0b2e; --card: #2d1454; --text: #ffffff; --primary: #bc13fe; --border: rgba(255,255,255,0.1); }

        [data-theme="forest"] { --bg: #0a1a0a; --card: #142d14; --text: #ffffff; --primary: #2ecc71; --border: rgba(255,255,255,0.1); }

        [data-theme="sunset"] { --bg: #1a0f0f; --card: #2d1414; --text: #ffffff; --primary: #e67e22; --border: rgba(255,255,255,0.1); }

        [data-theme="gold"] { --bg: #11110a; --card: #222214; --text: #ffffff; --primary: #f1c40f; --border: rgba(255,255,255,0.1); }

        

        * { box-sizing: border-box; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); }

        body { font-family: 'Cairo', sans-serif; background: var(--bg); color: var(--text); margin: 0; min-height: 100vh; overflow-x: hidden; }

        .floating-badge {

            position: fixed; bottom: 20px; right: 20px;

            background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px);

            border: 1px solid var(--primary); color: var(--primary);

            padding: 10px 20px; border-radius: 50px; font-weight: 900;

            box-shadow: 0 0 20px rgba(0, 212, 255, 0.3); z-index: 9999;

            animation: pulse 2s infinite, float 3s ease-in-out infinite; display: none;

        }

        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(0,212,255,0.4); } 70% { box-shadow: 0 0 0 15px rgba(0,212,255,0); } }

        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        

        #loader { position: fixed; inset: 0; background: #000; display: flex; justify-content: center; align-items: center; z-index: 10000; }

        .spinner { width: 50px; height: 50px; border: 5px solid #111; border-top-color: var(--primary); border-radius: 50%; animation: spin 0.8s infinite ease-in-out; }

        @keyframes spin { to { transform: rotate(360deg); } }

        .header { text-align: center; padding: 30px 0; position: relative; }

        #settingsBtn { display: none; position: absolute; top: 60px; left: 15px; z-index: 100; }

        #downloadBtn { display: none; position: absolute; top: 15px; left: 15px; z-index: 100; }

        #themeToggle { display: none; position: absolute; top: 105px; left: 15px; z-index: 100; }

        .user-logo { width: 100px; height: 100px; border-radius: 20px; border: 2px solid var(--primary); box-shadow: 0 0 20px var(--primary); object-fit: cover; }

        .ziad-name { font-size: 2rem; font-weight: 900; text-shadow: 0 0 15px var(--primary); margin: 10px 0; }

        

        .glass-panel { background: rgba(255,255,255,0.03); backdrop-filter: blur(15px); border: 1px solid var(--border); border-radius: 25px; padding: 35px; width: 90%; max-width: 400px; margin: 40px auto; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }

        input, select, textarea { width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; border: 1px solid var(--border); background: rgba(0,0,0,0.3); color: var(--text); text-align: center; font-family: 'Cairo'; outline: none; }

        input:focus, textarea:focus { border-color: var(--primary); box-shadow: 0 0 10px var(--primary); }

        

        .btn { background: linear-gradient(45deg, #0056b3, var(--primary)); color: white; border: none; padding: 12px; border-radius: 10px; font-weight: 700; cursor: pointer; width: 100%; font-size: 1rem; }

        .btn:hover { transform: translateY(-3px); box-shadow: 0 8px 20px var(--primary); }

        

        #libraryContent { display: none; padding: 20px; max-width: 1300px; margin: auto; animation: fadeIn 0.5s ease; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        

        .top-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; gap: 15px; flex-wrap: wrap; }

        .status-chip { background: var(--card); padding: 8px 16px; border-radius: 50px; border: 1px solid var(--primary); cursor: pointer; font-size: 0.85rem; display: flex; align-items: center; gap: 8px; font-weight: bold; }

        .status-chip:hover { background: var(--primary); color: #000; }

        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: none; z-index: 2000; padding: 0; backdrop-filter: blur(5px); }

        .modal-box { background: var(--card); max-width: 100%; margin: 0; padding: 0; border-radius: 0; border: none; position: relative; max-height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        #readerModal .modal-box { max-width: 100%; height: 100vh; padding: 0; }

        #readerToolbar { background: var(--card); padding: 10px; display: flex; align-items: center; gap: 10px; border-bottom: 1px solid var(--border); }

        #readerToolbar button { background: transparent; border: none; color: var(--text); cursor: pointer; font-size: 1rem; }

        #readerToolbar input { width: 60px; text-align: center; }

        #readerToolbar select { background: rgba(0,0,0,0.3); color: var(--text); border: 1px solid var(--border); }

        #pdfViewer { flex-grow: 1; overflow-y: auto; padding: 20px; text-align: center; }

        .page-canvas { margin-bottom: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }

        #searchInput { flex-grow: 1; }

        .controls { display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 12px; background: var(--card); padding: 15px; border-radius: 15px; margin-bottom: 30px; border: 1px solid var(--border); }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }

        

        .card { background: var(--card); border-radius: 20px; padding: 12px; border: 1px solid var(--border); position: relative; overflow: hidden; display: flex; flex-direction: column; }

        .card:hover { transform: translateY(-10px); border-color: var(--primary); box-shadow: 0 10px 20px rgba(0,0,0,0.4); }

        .card-tag { position: absolute; top: 12px; right: 12px; background: var(--primary); color: #000; font-size: 0.7rem; padding: 4px 10px; border-radius: 8px; font-weight: 900; z-index: 5; }

        .preview { width: 100%; aspect-ratio: 3/4; border-radius: 12px; object-fit: cover; background: #111; cursor: pointer; }

        

        .book-title { font-weight: 900; color: var(--primary); text-align: center; margin: 10px 0 5px 0; font-size: 1.1rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        .book-author { font-size: 0.85rem; color: #ccc; text-align: center; margin-bottom: 5px; font-weight: 600; }

        .book-meta { font-size: 0.7rem; color: #777; margin-bottom: 10px; text-align: center; display: flex; justify-content: center; gap: 10px; }

        .card-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: auto; }

        .btn-s { padding: 8px; border-radius: 8px; border: none; font-weight: bold; font-size: 0.8rem; cursor: pointer; color: #fff; transition:0.2s; }

        .btn-edit { background: rgba(255,255,255,0.1); color: var(--primary); border: 1px solid var(--primary); grid-column: span 2; }

        

        .book-rating { color: #f1c40f; font-size: 0.9rem; margin-bottom: 5px; text-align: center; }

        #toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: var(--primary); color: #000; padding: 12px 30px; border-radius: 15px; font-weight: 800; display: none; z-index: 5000; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }

        

        @media (max-width: 600px) {

            .grid { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; }

            .controls { grid-template-columns: 1fr; }

        }

        .footer { text-align: center; padding: 40px; color: #666; font-size: 0.9rem; font-weight: bold; }

        svg.icon { width: 32px; height: 32px; margin-bottom: 5px; stroke: var(--primary); }

    </style>

</head>

<body data-theme="dark">

    <div id="loader"><div class="spinner"></div></div>

    <div class="floating-badge" id="floatingBadge">Ziad Ø§Ù„Ø¨Ø§Ø¨Ø§ ğŸ˜</div>

    

    <div class="header">

        <div id="downloadBtn">

            <button class="status-chip" onclick="playAudio('click'); openDownloadModal()">ğŸ“š ØªÙ†Ø²ÙŠÙ„ ÙƒØªØ¨</button>

        </div>

        <div id="settingsBtn">

            <button class="status-chip" onclick="playAudio('click'); openSettings()">âš™ï¸ ØªØ¸Ø¨ÙŠØ· Ø§Ù„Ù…Ø³Ø§Ø¦Ù„</button>

        </div>

        <div id="themeToggle">

            <button class="status-chip" onclick="playAudio('click'); toggleTheme()">ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ ğŸŒ—</button>

        </div>

        <img src="favicon.png" class="user-logo" onerror="this.src='https://cdn-icons-png.flaticon.com/512/1043/1043322.png'">

        <div class="ziad-name">Ziad Library <span style="font-size:1rem; vertical-align:middle; color:var(--primary)">VIP</span></div>

    </div>

    <div id="welcomePage" class="glass-panel" style="display:none">

        <h2 style="color:var(--primary); margin-top:0">Ù…ÙƒØªØ¨ØªÙƒ Ø§Ù„Ø®Ø§ØµØ© Ø¨ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±Ùƒ</h2>

        <p style="font-size:0.9rem; color:#aaa; margin-bottom:15px;">Ù‡Ø°Ù‡ Ù…ÙƒØªØ¨Ø© Ø´Ø®ØµÙŠØ© Ù„Ø¥Ø¯Ø§Ø±Ø© ÙƒØªØ¨Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© Ø¨Ø£Ù…Ø§Ù† ÙˆØ±ÙˆÙ‚Ø§Ù†.</p>

        <button class="btn" onclick="choosePasswordMode()">Ø§Ù†Ø´ÙŠ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>

        <button class="btn" style="background:#333; margin-top:10px" onclick="chooseNoPasswordMode()">Ø§Ø¨Ø¯Ø§ Ø¨Ø¯ÙˆÙ† ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±</button>

    </div>

    <div id="loginPage" class="glass-panel">

        <h2 id="loginTitle" style="color:var(--primary); margin-top:0">Ø®Ø´ Ø¨Ø±Ø¬Ù„Ùƒ Ø§Ù„ÙŠÙ…ÙŠÙ† ÙŠØ§ Ù…Ø¹Ù„Ù… ğŸ¦µ</h2>

        <p id="loginDesc" style="font-size:0.9rem; color:#aaa; margin-bottom:15px; display:none">Ø´ÙƒÙ„Ùƒ Ø£ÙˆÙ„ Ù…Ø±Ø© ØªØ´Ø±ÙÙ†Ø§ØŒ Ø§Ø¹Ù…Ù„Ùƒ ÙƒÙ„Ù…Ø© Ø³Ø± Ø¹Ø´Ø§Ù† Ù…Ø­Ø¯Ø´ ÙŠÙØªØ´ ÙÙŠ ÙƒØªØ¨Ùƒ:</p>

        <input type="password" id="passIn" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ÙŠØ§ Ø´Ù‚ÙŠÙ‚">

        <div id="secSetup" style="display:none">

            <input type="text" id="secQuestion" placeholder="Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£Ù…Ø§Ù† (Ù…Ø«Ù„: Ø·ÙˆÙ„Ùƒ ÙƒØ§Ù…ØŸ)">

            <input type="text" id="secAnswer" placeholder="Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø£Ù…Ø§Ù† (Ø§ÙØªÙƒØ±Ù‡Ø§ ÙƒÙˆÙŠØ³)">

        </div>

        <button id="loginBtn" class="btn" onclick="handleAuth()">Ø§ÙØªØ­ ÙŠØ§ Ø³Ù…Ø³Ù… ğŸ”“</button>

        <p id="forgotPassLink" onclick="playAudio('click'); showPage('secPage')" style="cursor:pointer; font-size:0.8rem; margin-top:20px; color:#555">Ù†Ø³ÙŠØª Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ØŸ ÙƒØ¨Ø± Ø¯Ù…Ø§ØºÙƒ ÙˆØ¯ÙˆØ³ Ù‡Ù†Ø§</p>

        <button class="btn" style="background:#198754; margin-top:15px" onclick="playAudio('click'); openContactModal()">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ ğŸ“</button>

        <button class="btn" style="background:#6f42c1; margin-top:15px" onclick="playAudio('click'); openAboutModal()">Ù„Ù…Ø­Ø© Ø¹Ù†Ø§ â„¹ï¸</button>

    </div>

    <div id="secPage" class="glass-panel" style="display:none">

        <h3 style="color:var(--primary)">Ù†Ø³ÙŠØª ÙˆÙ„Ø§ Ø¥ÙŠÙ‡ØŸ ğŸ¤”</h3>

        <p style="font-size:0.9rem" id="secQuestionText">Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£Ù…Ø§Ù†: </p>

        <input type="text" id="secAns" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ù‡Ù†Ø§">

        <button class="btn" onclick="checkSec()">ÙŠÙ„Ø§ Ø¨ÙŠÙ†Ø§</button>

        <button class="btn" style="background:transparent; color:#777; margin-top:10px" onclick="playAudio('click'); showPage('loginPage')">Ø§Ø±Ø¬Ø¹ ÙŠØ§ Ù…Ø¬Ù†ÙˆÙ†</button>

    </div>

    <div id="libraryContent">

        <div class="top-nav">

            <div style="display:flex; gap:10px">

                <div class="status-chip" onclick="playAudio('popup');" id="storageChip">ğŸ’¾ Ø§Ù„Ù…Ø®Ø²Ù†: <span id="totalStorage">0 KB</span></div>

                <div class="status-chip" onclick="playAudio('trash'); showBin()" style="border-color:var(--danger); color:var(--danger)">ğŸ—‘ï¸ Ø§Ù„Ø²Ø¨Ø§Ù„Ø© (<span id="binCount">0</span>)</div>

            </div>

            <div style="display:flex; gap:10px">

                <button class="status-chip" style="background:#198754; color:#fff; border:none" onclick="playAudio('success'); exportData()">ğŸ“¤ Ø®Ø¯ Ù†Ø³Ø®Ø© (ØªØµØ¯ÙŠØ±)</button>

                <button class="status-chip" style="background:#6f42c1; color:#fff; border:none" onclick="playAudio('click'); document.getElementById('importFile').click()">ğŸ“¥ Ø±Ø¬Ø¹ Ø§Ù„Ù†Ø³Ø®Ø© (Ø§Ø³ØªÙŠØ±Ø§Ø¯)</button>

                <input type="file" id="importFile" accept=".json" style="display:none" onchange="importData(event)">

            </div>

        </div>

        <div class="controls">

            <input type="text" id="search" placeholder="ğŸ” Ø¨ØªØ¯ÙˆØ± Ø¹Ù„Ù‰ Ø¥ÙŠÙ‡ ÙŠØ§ ØºØ§Ù„ÙŠØŸ" oninput="render()">

            <select id="catFilter" onchange="playAudio('click'); render()">

                <option value="all">ğŸ“ ÙƒÙ„Ù‡ Ø¹Ù„Ù‰ Ø¨Ø¹Ø¶Ù‡</option>

                <option value="ÙƒØªØ¨">ğŸ“š ÙƒØªØ¨ Ø¬Ø¯</option>

                <option value="Ø±ÙˆØ§ÙŠØ§Øª">ğŸ­ Ø±ÙˆØ§ÙŠØ§Øª ÙˆØ­ÙƒØ§ÙŠØ§Øª</option>

                <option value="Ù…Ù„Ø®ØµØ§Øª">ğŸ“ Ø¨Ø±Ø´Ø§Ù…Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</option>

                <option value="Ø£Ø®Ø±Ù‰">âœ¨ Ø­Ø§Ø¬Ø§Øª ØªØ§Ù†ÙŠØ©</option>

            </select>

            <select id="sort" onchange="playAudio('click'); render()">

                <option value="new">ğŸ•’ Ù„Ø³Ù‡ ÙˆØ§ØµÙ„</option>

                <option value="az">ğŸ”¤ Ù…Ù† Ø§Ù„Ø£Ù„Ù Ù„Ù„ÙŠØ§Ø¡</option>

            </select>

            <button class="btn" onclick="playAudio('popup'); document.getElementById('fileIn').click()">â• Ø§Ø±ÙØ¹ ÙŠØ§ Ù†Ø¬Ù…</button>

            <input type="file" id="fileIn" accept=".pdf" style="display:none" onchange="upload(event)">

        </div>

        <div class="grid" id="grid"></div>

    </div>

    <div id="settingsModal" class="modal"><div class="modal-box">

        <h4 style="color:var(--primary); margin-top:0">ØªØ¸Ø¨ÙŠØ· Ø§Ù„Ù…Ø³Ø§Ø¦Ù„ âš™ï¸</h4>

        <label>Ø§Ù„Ø±ÙˆÙ‚Ø§Ù† ÙˆØ§Ù„Ø£Ù„ÙˆØ§Ù†:</label>

        <select id="themeSelect" onchange="playAudio('click'); setTheme(this.value)">

            <option value="dark">Ø¶Ù„Ù…Ø© (Ù„Ù„Ø¹Ø¸Ù…Ø§Ø¡)</option><option value="light">Ù†ÙˆØ± (ÙŠØ¹Ù…ÙŠ Ø§Ù„Ø¹ÙŠÙ†)</option><option value="purple">Ø¨Ù†ÙØ³Ø¬ÙŠ (Ø±ÙˆÙ‚Ø§Ù†)</option><option value="forest">ØºØ§Ø¨Ø© (Ø·Ø¨ÙŠØ¹Ø©)</option><option value="sunset">ØºØ±ÙˆØ¨ (Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠ)</option><option value="gold">Ø¯Ù‡Ø¨ÙŠ (ÙŠØ§ Ø¨Ø§Ø´Ø§)</option>

        </select>

        <button class="btn" onclick="playAudio('click'); openChangePassModal()">ØºÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ğŸ”‘</button>

        <button class="btn" style="background:var(--danger); margin-top:15px" onclick="playAudio('trash'); deleteAllBooks()">Ø§Ø­Ø°Ù ÙƒÙ„Ù‡ ğŸ—‘ï¸</button>

        <button class="btn" style="background:#198754; margin-top:15px" onclick="playAudio('click'); openContactModal()">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ ğŸ“</button>

        <button class="btn" style="background:#6f42c1; margin-top:15px" onclick="playAudio('click'); openAboutModal()">Ù„Ù…Ø­Ø© Ø¹Ù†Ø§ â„¹ï¸</button>

        <button class="btn" style="background:#333; margin-top:15px" onclick="playAudio('click'); closeModals()">ÙÙƒÙƒ (Ø¥ØºÙ„Ø§Ù‚)</button>

    </div></div>

    <div id="changePassModal" class="modal"><div class="modal-box">

        <h4 style="color:var(--primary); margin-top:0">ØºÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ÙˆØ³Ø¤Ø§Ù„ Ø§Ù„Ø£Ù…Ø§Ù†</h4>

        <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:</label>

        <input type="password" id="newPassInput" placeholder="Ø§ÙƒØªØ¨ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">

        <label>Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯:</label>

        <input type="text" id="newSecQuestion" placeholder="Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ù…Ø«Ù„: Ø·ÙˆÙ„Ùƒ ÙƒØ§Ù…ØŸ)">

        <label>Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:</label>

        <input type="text" id="newSecAnswer" placeholder="Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">

        <button class="btn" onclick="playAudio('success'); saveNewPassAndSec()">Ø§Ø¹ØªÙ…Ø¯ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ğŸ‘Œ</button>

        <button class="btn" style="background:#333; margin-top:10px" onclick="playAudio('click'); closeModals()">Ø¥ØºÙ„Ø§Ù‚</button>

    </div></div>

    <div id="aboutModal" class="modal"><div class="modal-box">

        <h4 style="color:var(--primary); margin-top:0">Ù„Ù…Ø­Ø© Ø¹Ù†Ø§</h4>

        <p style="font-size:0.9rem; color:#aaa; margin-bottom:15px;">Ø¯Ù‡ Ù…ÙˆÙ‚Ø¹ Ù…ÙƒØªØ¨Ø© Ø²ÙŠØ§Ø¯ØŒ Ø§Ù„Ø±ÙˆÙ‚Ø§Ù† ÙƒÙ„Ù‡ 2026 â˜•ØŒ Ø¹Ø´Ø§Ù† ØªØ¯ÙŠØ± ÙƒØªØ¨Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© Ø¨Ø£Ù…Ø§Ù† ÙˆØ³Ù‡ÙˆÙ„Ø© ÙŠØ§ Ù…Ø¹Ù„Ù…. Ù‡Ù†Ø§ ØªÙ‚Ø¯Ø± ØªØ±ÙØ¹ ÙƒØªØ¨Ùƒ Ø§Ù„Ù€ PDFØŒ ØªØµÙ†ÙÙ‡Ø§ØŒ ØªØ¨Ø­Ø« ÙÙŠÙ‡Ø§ØŒ ØªÙ‚Ø±Ø§Ù‡Ø§ØŒ ÙˆØªØ­Ù…Ù„Ù‡Ø§ Ø²ÙŠ Ù…Ø§ Ø§Ù†Øª Ø¹Ø§ÙŠØ². Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø¯ÙŠ Ø´Ø®ØµÙŠØ© ØªÙ…Ø§Ù…Ù‹Ø§ØŒ Ù…Ø¹ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¹Ø´Ø§Ù† Ù…Ø­Ø¯Ø´ ÙŠÙØªØ´ ÙÙŠ Ø­Ø§Ø¬Ø§ØªÙƒØŒ ÙˆÙÙŠÙ‡Ø§ Ø®Ø§ØµÙŠØ© ØªØµØ¯ÙŠØ± ÙˆØ§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø´Ø§Ù† ØªÙ†Ù‚Ù„ ÙƒØªØ¨Ùƒ Ø¨Ø³Ù‡ÙˆÙ„Ø©. ÙƒÙ…Ø§Ù† ÙÙŠÙ‡Ø§ Ø³Ù„Ø© Ù…Ù‡Ù…Ù„Ø§Øª Ø¹Ø´Ø§Ù† Ù„Ùˆ ØºÙ„Ø·Øª ÙÙŠ Ø­Ø°Ù Ø­Ø§Ø¬Ø© ØªÙ‚Ø¯Ø± ØªØ±Ø¬Ø¹Ù‡Ø§ØŒ ÙˆØªØºÙŠÙŠØ± Ø§Ù„Ø«ÙŠÙ…Ø§Øª Ø¹Ø´Ø§Ù† ØªØ±ÙŠØ­ Ø¹ÙŠÙˆÙ†Ùƒ. ÙƒÙ„ Ø¯Ù‡ Ù…ØµÙ…Ù… Ø¨Ø£Ø­Ø¯Ø« Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø¹Ø´Ø§Ù† ÙŠØ´ØªØºÙ„ Ø¢ÙÙ„Ø§ÙŠÙ† ÙƒÙ…Ø§Ù† Ø²ÙŠ Ø§Ù„Ù€ PWA. Ù…Ù† ØµÙ†Ø¹ ÙˆØ¥Ø¹Ø¯Ø§Ø¯ Ø²ÙŠØ§Ø¯ Ø§Ù„Ø¯Ø±ÙŠÙ†ÙŠØŒ ÙŠØ§ Ø±ÙŠØ³!</p>

        <button class="btn" style="background:#333; margin-top:10px" onclick="playAudio('click'); closeModals()">Ø¥ØºÙ„Ø§Ù‚</button>

    </div></div>

    <div id="contactModal" class="modal"><div class="modal-box">

        <h4 style="color:var(--primary); margin-top:0">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ ğŸ“¬</h4>

        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 20px;">

            <div style="text-align: center; padding: 15px; background: var(--card); border: 1px solid var(--border); border-radius: 15px;">

                <svg class="icon" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>

                <div style="font-weight: bold; color: var(--primary);">Ø§ØªØµØ§Ù„/ÙˆØ§ØªØ³Ø§Ø¨</div>

                <a href="tel:01055662785" class="btn-s" style="background:var(--primary); color:#000; margin-top:5px; display:block; text-decoration:none;">Ø§ØªØµØ§Ù„</a>

                <a href="https://wa.me/01055662785" target="_blank" class="btn-s" style="background:#25D366; color:#fff; margin-top:5px; display:block; text-decoration:none;">ÙˆØ§ØªØ³Ø§Ø¨</a>

            </div>

            <div style="text-align: center; padding: 15px; background: var(--card); border: 1px solid var(--border); border-radius: 15px;">

                <svg class="icon" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/></svg>

                <div style="font-weight: bold; color: var(--primary);">ÙÙŠØ³Ø¨ÙˆÙƒ</div>

                <a href="https://www.facebook.com/profile.php?id=61583039190517&locale=ar_AR" target="_blank" style="color: #1877F2; text-decoration: none;">Ø²ÙŠØ§Ø±Ø© Ø§Ù„ØµÙØ­Ø©</a>

            </div>

            <div style="text-align: center; padding: 15px; background: var(--card); border: 1px solid var(--border); border-radius: 15px;">

                <svg class="icon" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7.8,2H16.2C19.4,2 22,4.6 22,7.8V16.2A5.8,5.8 0 0,1 16.2,22H7.8C4.6,22 2,19.4 2,16.2V7.8A5.8,5.8 0 0,1 7.8,2M7.6,4A3.6,3.6 0 0,0 4,7.6V16.4C4,18.39 5.61,20 7.6,20H16.4A3.6,3.6 0 0,0 20,16.4V7.6C20,5.61 18.39,4 16.4,4H7.6M17.25,5.5A1.25,1.25 0 0,1 18.5,6.75A1.25,1.25 0 0,1 17.25,8A1.25,1.25 0 0,1 16,6.75A1.25,1.25 0 0,1 17.25,5.5M12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9Z"/></svg>

                <div style="font-weight: bold; color: var(--primary);">Ø¥Ù†Ø³ØªØºØ±Ø§Ù…</div>

                <a href="https://www.instagram.com/ziadalzoz1020/" target="_blank" class="btn-s" style="background:linear-gradient(45deg, #f09433 0%,#e6683c 25%,#dc2743 50%,#cc2366 75%,#bc1888 100%); color:#fff; margin-top:5px; display:block; text-decoration:none;">Ø¥Ù†Ø³ØªØºØ±Ø§Ù…</a>

            </div>

        </div>

        <button class="btn" style="background:#333; margin-top:10px" onclick="playAudio('click'); closeModals()">Ø¥ØºÙ„Ø§Ù‚</button>

    </div></div>

    <div id="uploadModal" class="modal"><div class="modal-box">

        <h4 style="color:var(--primary)">Ù‡Ø§Øª Ù…Ø§ Ø¹Ù†Ø¯Ùƒ ÙŠØ§ Ù…Ø¨Ø¯Ø¹</h4>

        <div id="pendingFileName" style="font-size:0.8rem; color:#888; margin-bottom:10px"></div>

        <label>Ø§Ø³Ù… Ø§Ù„ÙƒØªØ§Ø¨ (Ø¹Ø´Ø§Ù† Ù…ØªØªÙˆÙ‡Ø´):</label>

        <input type="text" id="bookNameInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… Ù‡Ù†Ø§">

        <label>Ù…ÙŠÙ† Ø§Ù„Ù„ÙŠ ÙƒØªØ¨Ù‡ØŸ:</label>

        <input type="text" id="authorInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¤Ù„Ù (Ù„Ùˆ Ù…Ø´ Ø¹Ø§Ø±Ù Ø§ÙƒØªØ¨ 'ÙˆØ§Ø­Ø¯ Ù…Ø¹Ø±ÙÙˆØ´')">

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px">

            <div>

                <label>Ù†ÙˆØ¹Ù‡ Ø¥ÙŠÙ‡ØŸ:</label>

                <select id="selectedCat"><option value="ÙƒØªØ¨">ÙƒØªØ¨</option><option value="Ø±ÙˆØ§ÙŠØ§Øª">Ø±ÙˆØ§ÙŠØ§Øª</option><option value="Ù…Ù„Ø®ØµØ§Øª">Ù…Ù„Ø®ØµØ§Øª</option><option value="Ø£Ø®Ø±Ù‰">ÙƒÙˆÙƒØªÙŠÙ„</option></select>

            </div>

            <div>

                <label>ÙŠØ³ØªØ§Ù‡Ù„ ÙƒØ§Ù…ØŸ:</label>

                <select id="bookRatingInput">

                    <option value="5">â­â­â­â­â­ Ø¹Ø§Ù„Ù…ÙŠ</option><option value="4">â­â­â­â­ Ø¬Ø§Ù…Ø¯</option><option value="3">â­â­â­ Ø´ØºØ§Ù„</option><option value="2">â­â­ Ù…Ø´ Ù‚Ø¯ ÙƒØ¯Ø©</option><option value="1">â­ ÙŠØ¶ÙŠØ¹ Ø§Ù„ÙˆÙ‚Øª</option>

                </select>

            </div>

        </div>

        <label>ÙƒÙ„Ù…ØªÙŠÙ† ÙÙŠ Ø­Ù‚ Ø§Ù„ÙƒØªØ§Ø¨:</label>

        <textarea id="bookDescInput" rows="3" placeholder="Ø§Ø­ÙƒÙŠ Ø¨Ø§Ø®ØªØµØ§Ø±..."></textarea>

        <button class="btn" id="confirmUploadBtn">Ø·ÙŠØ± Ø§Ù„ÙƒØªØ§Ø¨ Ù„Ù„Ù…ÙƒØªØ¨Ø© ğŸš€</button>

        <button class="btn" style="background:#333; margin-top:10px" onclick="playAudio('click'); closeModals()">ÙƒÙ†Ø³Ù„ ÙŠØ§ Ø¹Ù…</button>

    </div></div>

    <div id="editModal" class="modal"><div class="modal-box">

        <h4 style="color:var(--primary)">Ø¹Ø¯Ù„ Ø¨Ø±Ø§Ø­ØªÙƒ</h4>

        <input type="hidden" id="editBookId">

        <label>Ø§Ø³Ù… Ø§Ù„ÙƒØªØ§Ø¨:</label>

        <input type="text" id="editName">

        <label>Ø§Ù„Ù…Ø¤Ù„Ù:</label>

        <input type="text" id="editAuthor">

        <label>Ø§Ù„ØªØµÙ†ÙŠÙ:</label>

        <select id="editCat"><option value="ÙƒØªØ¨">ÙƒØªØ¨</option><option value="Ø±ÙˆØ§ÙŠØ§Øª">Ø±ÙˆØ§ÙŠØ§Øª</option><option value="Ù…Ù„Ø®ØµØ§Øª">Ù…Ù„Ø®ØµØ§Øª</option><option value="Ø£Ø®Ø±Ù‰">ÙƒÙˆÙƒØªÙŠÙ„</option></select>

        <label>Ø§Ù„ÙˆØµÙ:</label>

        <textarea id="editDesc" rows="3"></textarea>

        <button class="btn" onclick="saveEdit()">Ø³ÙŠÙ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª ğŸ’¾</button>

        <button class="btn" style="background:#333; margin-top:10px" onclick="closeModals()">Ø®Ù„Ø§Øµ Ù…Ø´ Ù…Ø¹Ø¯Ù„</button>

    </div></div>

    <div id="readerOptionModal" class="modal"><div class="modal-box">

        <h4 style="color:var(--primary)">ÙƒÙŠÙ ØªØ¨Ø¯Ø£ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©ØŸ</h4>

        <button class="btn" id="continueBtn">ØªØ§Ø¨Ø¹ Ø¹Ù†Ø¯ Ù…Ø§ ØªÙˆÙ‚ÙØª</button>

        <button class="btn" style="background:#333; margin-top:10px" id="startNewBtn">Ø§Ø¨Ø¯Ø£ Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</button>

        <button class="btn" style="background:var(--danger); margin-top:10px" onclick="closeModals()">Ø¥ØºÙ„Ø§Ù‚</button>

    </div></div>

    <div id="readerModal" class="modal">

        <div class="modal-box">

            <div id="readerToolbar">

                <button onclick="closeReader()" style="background:none; border:none; color:var(--danger); cursor:pointer; font-size:1.2rem">âœ–</button>

                <span id="readerTitle">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ÙƒØªØ§Ø¨</span>

                <button onclick="prevPage()">â—€</button>

                <input type="number" id="pageInput" min="1" style="width:50px;">

                <span id="pageTotal"> / 1</span>

                <button onclick="nextPage()">â–¶</button>

                <button onclick="zoomIn()">+</button>

                <button onclick="zoomOut()">-</button>

                <select id="viewMode" onchange="changeViewMode(this.value)">

                    <option value="single">ØµÙØ­Ø© ÙˆØ§Ø­Ø¯Ø©</option>

                    <option value="continuous">Ù…ØªØªØ§Ù„ÙŠ</option>

                    <option value="two">ØµÙØ­ØªÙŠÙ†</option>

                </select>

                <input type="text" id="searchInput" placeholder="Ø¨Ø­Ø«..." onkeyup="if(event.keyCode==13) searchPdf()">

                <button onclick="searchPdf()">ğŸ”</button>

                <button onclick="toggleFullScreen()">ğŸ–¥ï¸</button>

                <button onclick="rotatePdf()">â†»</button>

                <button onclick="printPdf()">ğŸ–¨ï¸</button>

            </div>

            <div id="pdfViewer" style="overflow:auto; flex-grow:1; padding:10px; text-align:center;"></div>

        </div>

    </div>

    <div id="binModal" class="modal"><div class="modal-box">

        <h4 style="color:var(--danger)">Ù…ÙƒØ¨ Ø§Ù„Ù†ÙØ§ÙŠØ§Øª ğŸ—‘ï¸</h4>

        <div id="binList"></div>

        <button class="btn" style="background:var(--danger)" onclick="emptyBin()">ÙØ±Ù…ØªØ© (Ø­Ø°Ù Ø§Ù„ÙƒÙ„)</button>

        <button class="btn" style="background:#333; margin-top:10px" onclick="playAudio('click'); closeModals()">Ø§Ù‚ÙÙ„ Ø§Ù„Ø±ÙŠØ­Ø© Ø·Ø§Ù„Ø¹Ø© ğŸ˜·</button>

    </div></div>

    <div id="downloadModal" class="modal"><div class="modal-box">

        <h4 style="color:var(--primary); margin-top:0">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙƒØªØ¨Ø©</h4>

        <button class="btn" onclick="window.open('https://www.noor-book.com/', '_blank')">Ù…ÙƒØªØ¨Ø© Ù†ÙˆØ±</button>

        <button class="btn" style="margin-top:10px" onclick="window.open('https://www.kotobati.com/', '_blank')">Ù…ÙƒØªØ¨Ø© ÙƒØªÙˆØ¨Ø§ØªÙŠ</button>

        <button class="btn" style="background:#333; margin-top:10px" onclick="playAudio('click'); closeModals()">Ø¥ØºÙ„Ø§Ù‚</button>

    </div></div>

    <div id="toast"></div>

    <div class="footer">ØµÙ†Ø¹ Ø¨ÙƒÙ„ Ø±ÙˆÙ‚Ø§Ù† Ø¨ÙˆØ§Ø³Ø·Ø© Ziad Library Pro &copy; 2026 â˜•</div>

    <script>

        if ('serviceWorker' in navigator) {

            window.addEventListener('load', () => {

                const swCode = `

                    const CACHE_NAME = 'ziad-lib-v1';

                    self.addEventListener('install', e => e.waitUntil(caches.open(CACHE_NAME).then(c => c.addAll(['/']))));

                    self.addEventListener('fetch', e => e.respondWith(caches.match(e.request).then(r => r || fetch(e.request))));

                `;

                const blob = new Blob([swCode], { type: 'text/javascript' });

                const swUrl = URL.createObjectURL(blob);

                navigator.serviceWorker.register(swUrl).catch(console.error);

            });

        }

        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

        

        const sounds = {

            click: "https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3",

            success: "https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3",

            trash: "https://assets.mixkit.co/active_storage/sfx/2570/2570-preview.mp3",

            error: "https://assets.mixkit.co/active_storage/sfx/2572/2572-preview.mp3",

            popup: "https://assets.mixkit.co/active_storage/sfx/2580/2580-preview.mp3",

            engine: "https://assets.mixkit.co/active_storage/sfx/876/876-preview.mp3"

        };

        

        function playAudio(type) {

            const audio = new Audio(sounds[type]);

            audio.volume = 0.5;

            audio.play().catch(e => console.log("Audio blocked"));

        }

        let db;

        let currentPass = localStorage.getItem('ziadPass');

        let secQuestion = localStorage.getItem('ziadSecQuestion');

        let secAnswer = localStorage.getItem('ziadSecAnswer');

        let pendingFile = null;

        let currentPdf = null;

        let currentPage = 1;

        let numPages = 0;

        let currentBookId = null;

        let scale = 1.5;

        let viewMode = 'continuous';

        let rotation = 0;

        let searchText = '';

        let searchResults = [];

        let currentSearchIndex = -1;

        const init = () => {

            const theme = localStorage.getItem('ziadTheme') || 'dark';

            document.body.setAttribute('data-theme', theme);

            const mode = localStorage.getItem('ziadMode');

            if (!mode) {

                showPage('welcomePage');

            } else if (mode === 'noPassword') {

                enterLibrary();

            } else {

                showPage('loginPage');

                checkFirstVisit();

            }

        };

        

        function checkFirstVisit() {

            const title = document.getElementById('loginTitle');

            const desc = document.getElementById('loginDesc');

            const btn = document.getElementById('loginBtn');

            const forgot = document.getElementById('forgotPassLink');

            const secSetup = document.getElementById('secSetup');

            if (!currentPass) {

                title.innerText = "Ù…Ù†ÙˆØ± ÙŠØ§ ÙƒØ¨ÙŠØ± Ø§Ù„ÙƒÙˆÙƒØ¨ ğŸŒ";

                desc.style.display = "block";

                btn.innerText = "Ø§Ø­ÙØ¸ Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ ÙˆØ³Ø¤Ø§Ù„ Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ø¯Ø®Ù„ Ø¨Ø±Ø¬Ù„Ùƒ Ø§Ù„ÙŠÙ…ÙŠÙ†";

                forgot.style.display = "none";

                secSetup.style.display = "block";

            } else {

                secSetup.style.display = "none";

            }

        }

        

        function handleAuth() {

            const inputVal = document.getElementById('passIn').value;

            if (!inputVal) {

                showToast("âš ï¸ Ø§ÙƒØªØ¨ Ø£ÙŠ Ø­Ø§Ø¬Ø© ÙŠØ§ Ø¹Ù…!");

                return;

            }

            if (!currentPass) {

                const newSecQuestion = document.getElementById('secQuestion').value;

                const newSecAnswer = document.getElementById('secAnswer').value;

                if (!newSecQuestion || !newSecAnswer) {

                    showToast("âš ï¸ Ù„Ø§Ø²Ù… ØªÙƒØªØ¨ Ø³Ø¤Ø§Ù„ Ø£Ù…Ø§Ù† ÙˆØ¥Ø¬Ø§Ø¨ØªÙ‡ ÙŠØ§ Ù…Ø¹Ù„Ù…!");

                    return;

                }

                localStorage.setItem('ziadPass', inputVal);

                localStorage.setItem('ziadSecQuestion', newSecQuestion);

                localStorage.setItem('ziadSecAnswer', newSecAnswer);

                currentPass = inputVal;

                secQuestion = newSecQuestion;

                secAnswer = newSecAnswer;

                playAudio('success');

                showToast("âœ… Ø£Ù‡Ù„Ø§ Ø¨ÙŠÙƒ ÙŠØ§ Ø±ÙŠØ³ ÙÙŠ Ù…ÙƒØªØ¨ØªÙƒ");

                enterLibrary();

            } else {

                if (inputVal === currentPass) {

                    enterLibrary();

                } else {

                    playAudio('error');

                    showToast("âŒ ØºÙ„Ø· ÙŠØ§ Ø²Ù…ÙŠÙ„ÙŠ! Ø±ÙƒØ² Ø´ÙˆÙŠØ© ğŸ˜‚");

                }

            }

        }

        function enterLibrary() {

            playAudio('engine');

            showPage('libraryContent');

            render();

            showToast("Ù†ÙˆØ±Øª Ø§Ù„Ù…ÙƒØªØ¨Ø© ÙŠØ§ Ù‡Ù†Ø¯Ø³Ø© ğŸ’¡");

        }

        function setTheme(val) {

            localStorage.setItem('ziadTheme', val);

            document.body.setAttribute('data-theme', val);

        }

        function toggleTheme() {

            const current = document.body.getAttribute('data-theme');

            const newTheme = current === 'dark' ? 'light' : 'dark';

            setTheme(newTheme);

        }

        function openSettings() { playAudio('popup'); document.getElementById('settingsModal').style.display='block'; }

        function openDownloadModal() { playAudio('popup'); document.getElementById('downloadModal').style.display='block'; }

        function openContactModal() { playAudio('popup'); document.getElementById('contactModal').style.display='block'; }

        function openAboutModal() { playAudio('popup'); document.getElementById('aboutModal').style.display='block'; }

        function openChangePassModal() { playAudio('popup'); document.getElementById('changePassModal').style.display='block'; }

        function saveNewPassAndSec() {

            const np = document.getElementById('newPassInput').value;

            const nsq = document.getElementById('newSecQuestion').value;

            const nsa = document.getElementById('newSecAnswer').value;

            if (np && nsq && nsa) {

                localStorage.setItem('ziadPass', np);

                localStorage.setItem('ziadSecQuestion', nsq);

                localStorage.setItem('ziadSecAnswer', nsa);

                currentPass = np;

                secQuestion = nsq;

                secAnswer = nsa;

                showToast("âœ… ØºÙŠØ±Ù†Ø§ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ÙˆØ³Ø¤Ø§Ù„ Ø§Ù„Ø£Ù…Ø§Ù†ØŒ Ø§ÙˆØ¹Ù‰ ØªÙ†Ø³Ø§Ù‡Ù… Ø¨Ù‚Ù‰!");

                closeModals();

            } else {

                showToast("âš ï¸ Ù„Ø§Ø²Ù… ØªÙ…Ù„Ø£ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙŠØ§ Ù…Ø¹Ù„Ù…!");

            }

        }

        function deleteAllBooks() {

            if (confirm("Ù‡ØªØ­Ø°Ù ÙƒÙ„ Ø§Ù„ÙƒØªØ¨ Ø¨Ø¬Ø¯ØŸ Ù…ÙÙŠØ´ Ø±Ø¬Ø¹Ø© ÙŠØ§ Ø±ÙŠØ³! ğŸ˜±")) {

                const tx = db.transaction("books", "readwrite");

                tx.objectStore("books").clear().onsuccess = () => {

                    render();

                    updateStats();

                    showToast("ğŸ—‘ï¸ Ø¨Ø­.. ÙƒÙ„ Ø§Ù„ÙƒØªØ¨ Ø±Ø§Ø­Øª!");

                };

            }

        }

        const req = indexedDB.open("Ziad_Library_Pro_2026", 2);

        req.onupgradeneeded = (e) => {

            const d = e.target.result;

            if(!d.objectStoreNames.contains("books")) d.createObjectStore("books", {keyPath: "id", autoIncrement: true});

            if(!d.objectStoreNames.contains("bin")) d.createObjectStore("bin", {keyPath: "id", autoIncrement: true});

        };

        req.onsuccess = (e) => { 

            db = e.target.result; 

            updateStats();

            setTimeout(() => document.getElementById('loader').style.display='none', 800);

        };

        function showToast(m) {

            const t = document.getElementById('toast'); t.innerText = m;

            t.style.display = 'block'; setTimeout(() => t.style.display = 'none', 3000);

        }

        function showPage(id) {

            ['welcomePage', 'loginPage', 'secPage', 'libraryContent'].forEach(p => document.getElementById(p).style.display = 'none');

            document.getElementById(id).style.display = 'block';

            const sBtn = document.getElementById('settingsBtn');

            const dBtn = document.getElementById('downloadBtn');

            const tToggle = document.getElementById('themeToggle');

            const fBadge = document.getElementById('floatingBadge');

            if (id === 'libraryContent') { sBtn.style.display = 'block'; dBtn.style.display = 'block'; tToggle.style.display = 'block'; fBadge.style.display = 'block'; }

            else { sBtn.style.display = 'none'; dBtn.style.display = 'none'; tToggle.style.display = 'none'; fBadge.style.display = 'none'; }

            if (id === 'secPage') {

                document.getElementById('secQuestionText').innerText = 'Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£Ù…Ø§Ù†: ' + (secQuestion || 'Ø·ÙˆÙ„Ùƒ ÙƒØ§Ù… ÙŠØ§ Ø¹Ù… Ø§Ù„Ø·ÙˆÙŠÙ„ØŸ');

            }

        }

        function checkSec() {

            const inputAnswer = document.getElementById('secAns').value;

            if(inputAnswer === secAnswer) {

                playAudio('engine');

                showPage('libraryContent'); 

                showToast("Ø£ÙŠÙˆÙ‡ ÙƒØ¯Ø© ÙŠØ§ ÙˆØ¯ÙŠØ¹! Ù†ÙˆØ±Øª ğŸ˜‚"); 

                render();

            } else {

                playAudio('error');

                showToast("âš ï¸ Ø¨ØªÙØªÙŠ Ù„ÙŠÙ‡ØŸ ØºÙ„Ø·!");

            }

        }

        function closeModals() { 

            document.querySelectorAll('.modal').forEach(m => m.style.display='none'); 

        }

        function upload(e) {

            pendingFile = e.target.files[0];

            if(!pendingFile) return;

            playAudio('popup');

            document.getElementById('pendingFileName').innerText = pendingFile.name;

            document.getElementById('bookNameInput').value = pendingFile.name.replace('.pdf','');

            document.getElementById('uploadModal').style.display = 'block';

        }

        document.getElementById('confirmUploadBtn').onclick = async () => {

            const name = document.getElementById('bookNameInput').value;

            const author = document.getElementById('authorInput').value || "ÙØ§Ø¹Ù„ Ø®ÙŠØ±";

            const cat = document.getElementById('selectedCat').value;

            const desc = document.getElementById('bookDescInput').value || "Ù…Ù† ØºÙŠØ± ÙˆØµÙ";

            const rating = document.getElementById('bookRatingInput').value;

            const file = pendingFile;

            

            closeModals();

            showToast("â³ Ø§ØµØ¨Ø± Ø´ÙˆÙŠØ© Ø¨Ù†Ø­Ù…Ù„ Ø§Ù„ÙƒØªØ§Ø¨...");

            

            const r = new FileReader();

            r.onload = async (ev) => {

                const pdfData = ev.target.result;

                const pdfInfo = await getPdfInfo(pdfData);

                

                const tx = db.transaction("books", "readwrite");

                tx.objectStore("books").add({ 

                    name: name, author: author, data: pdfData, thumb: pdfInfo.thumb, 

                    pages: pdfInfo.pages, size: file.size, category: cat,

                    description: desc, rating: rating, date: new Date().toLocaleDateString('ar-EG') 

                });

                tx.oncomplete = () => { 

                    playAudio('success'); render(); updateStats(); showToast("âœ… Ø§Ù„ÙƒØªØ§Ø¨ ÙˆØµÙ„ Ø¨Ø§Ù„Ø³Ù„Ø§Ù…Ø©!"); 

                    document.getElementById('bookDescInput').value = ''; document.getElementById('authorInput').value = '';

                };

            };

            r.readAsDataURL(file);

        };

        async function getPdfInfo(data) {

            try {

                const pdf = await pdfjsLib.getDocument(data).promise;

                const page = await pdf.getPage(1);

                const canv = document.createElement('canvas');

                const view = page.getViewport({scale: 0.3});

                canv.width = view.width; canv.height = view.height;

                await page.render({canvasContext: canv.getContext('2d'), viewport: view}).promise;

                return { thumb: canv.toDataURL('image/jpeg', 0.6), pages: pdf.numPages };

            } catch { return { thumb: '', pages: 0 }; }

        }

        function render() {

            const g = document.getElementById('grid');

            const q = document.getElementById('search').value.toLowerCase();

            const s = document.getElementById('sort').value;

            const cf = document.getElementById('catFilter').value;

            g.innerHTML = "";

            

            const tx = db.transaction("books", "readonly");

            let books = [];

            tx.objectStore("books").openCursor().onsuccess = (e) => {

                const c = e.target.result;

                if(c) { 

                    const v = c.value;

                    if((v.name.toLowerCase().includes(q) || (v.author && v.author.toLowerCase().includes(q))) && (cf === 'all' || v.category === cf)) books.push(v); 

                    c.continue(); 

                } else {

                    books.sort((a,b) => s === 'az' ? a.name.localeCompare(b.name) : b.id - a.id);

                    books.forEach(b => {

                        const d = document.createElement('div'); d.className = 'card';

                        d.innerHTML = `

                            <div class="card-tag">${b.category || 'ÙƒÙˆÙƒØªÙŠÙ„'}</div>

                            <img src="${b.thumb || 'https://via.placeholder.com/150'}" class="preview" onclick="openReaderOptions(${b.id})">

                            <div class="book-title">${b.name}</div>

                            <div class="book-author">ğŸ‘¤ ${b.author || 'ÙØ§Ø¹Ù„ Ø®ÙŠØ±'}</div>

                            <div class="book-rating">${"â­".repeat(b.rating || 5)}</div>

                            <div class="book-meta">${b.pages ? b.pages+' ÙˆØ±Ù‚Ø©' : ''} | ${formatSize(b.size)}</div>

                            <div class="card-btns">

                                <button class="btn-s" style="background:var(--primary); color:#000" onclick="openReaderOptions(${b.id})">Ù‚Ø±Ø§Ø¡Ø© ğŸ“–</button>

                                <button class="btn-s" style="background:#333" onclick="downB(${b.id})">Ø­Ù…Ù„ ğŸ‘‡</button>

                                <button class="btn-s btn-edit" onclick="openEdit(${b.id})">Ø¸Ø¨Ø·Ù‡ âœï¸</button>

                                <button class="btn-s" style="background:var(--danger)" onclick="moveToBin(${b.id})">Ø§Ø±Ù…ÙŠÙ‡ ğŸ—‘ï¸</button>

                            </div>`;

                        g.appendChild(d);

                    });

                }

            };

        }

        

        function openReaderOptions(id) {

            playAudio('popup');

            currentBookId = id;

            document.getElementById('readerOptionModal').style.display = 'block';

            document.getElementById('continueBtn').onclick = () => openReader(id, true);

            document.getElementById('startNewBtn').onclick = () => openReader(id, false);

        }

        

        async function openReader(id, continueReading) {

            closeModals();

            document.getElementById('readerModal').style.display = 'block';

            document.getElementById('viewMode').value = viewMode;

            db.transaction("books").objectStore("books").get(id).onsuccess = async (e) => {

                const b = e.target.result;

                document.getElementById('readerTitle').innerText = b.name;

                currentPdf = await pdfjsLib.getDocument(b.data).promise;

                numPages = currentPdf.numPages;

                document.getElementById('pageTotal').innerText = ` / ${numPages}`;

                document.getElementById('pageInput').max = numPages;

                currentPage = continueReading ? (parseInt(localStorage.getItem('lastPage_' + id)) || 1) : 1;

                changeViewMode(viewMode);

            };

        }

        

        async function changeViewMode(mode) {

            viewMode = mode;

            const viewer = document.getElementById('pdfViewer');

            viewer.innerHTML = '';

            if (mode === 'continuous') {

                for (let i = 1; i <= numPages; i++) {

                    const canv = document.createElement('canvas');

                    canv.className = 'page-canvas';

                    viewer.appendChild(canv);

                    renderPageToCanvas(i, canv);

                }

            } else if (mode === 'two') {

                for (let i = 1; i <= numPages; i += 2) {

                    const container = document.createElement('div');

                    container.style.display = 'flex';

                    container.style.justifyContent = 'center';

                    container.style.marginBottom = '20px';

                    const canv1 = document.createElement('canvas');

                    canv1.className = 'page-canvas';

                    container.appendChild(canv1);

                    renderPageToCanvas(i, canv1);

                    if (i + 1 <= numPages) {

                        const canv2 = document.createElement('canvas');

                        canv2.className = 'page-canvas';

                        container.appendChild(canv2);

                        renderPageToCanvas(i + 1, canv2);

                    }

                    viewer.appendChild(container);

                }

            } else {

                const canv = document.createElement('canvas');

                canv.className = 'page-canvas';

                viewer.appendChild(canv);

                renderPageToCanvas(currentPage, canv);

                document.getElementById('pageInput').value = currentPage;

            }

        }

        

        async function renderPageToCanvas(pageNum, canvas) {

            const page = await currentPdf.getPage(pageNum);

            const viewport = page.getViewport({ scale: scale, rotation: rotation });

            canvas.height = viewport.height;

            canvas.width = viewport.width;

            await page.render({ canvasContext: canvas.getContext('2d'), viewport: viewport });

        }

        

        function prevPage() {

            if (viewMode === 'single' && currentPage > 1) {

                currentPage--;

                changeViewMode('single');

                localStorage.setItem('lastPage_' + currentBookId, currentPage);

            } else if (viewMode === 'two' && currentPage > 1) {

                currentPage -= 2;

                if (currentPage < 1) currentPage = 1;

                changeViewMode('two');

                localStorage.setItem('lastPage_' + currentBookId, currentPage);

            }

        }

        

        function nextPage() {

            if (viewMode === 'single' && currentPage < numPages) {

                currentPage++;

                changeViewMode('single');

                localStorage.setItem('lastPage_' + currentBookId, currentPage);

            } else if (viewMode === 'two' && currentPage < numPages) {

                currentPage += 2;

                if (currentPage > numPages) currentPage = numPages;

                changeViewMode('two');

                localStorage.setItem('lastPage_' + currentBookId, currentPage);

            }

        }

        

        function zoomIn() {

            scale += 0.2;

            changeViewMode(viewMode);

        }

        

        function zoomOut() {

            if (scale > 0.5) {

                scale -= 0.2;

                changeViewMode(viewMode);

            }

        }

        

        function rotatePdf() {

            rotation = (rotation + 90) % 360;

            changeViewMode(viewMode);

        }

        

        function printPdf() {

            window.print();

        }

        

        async function searchPdf() {

            searchText = document.getElementById('searchInput').value;

            searchResults = [];

            for (let i = 1; i <= numPages; i++) {

                const page = await currentPdf.getPage(i);

                const textContent = await page.getTextContent();

                const text = textContent.items.map(item => item.str).join('');

                if (text.toLowerCase().includes(searchText.toLowerCase())) {

                    searchResults.push(i);

                }

            }

            if (searchResults.length > 0) {

                currentSearchIndex = 0;

                currentPage = searchResults[0];

                changeViewMode(viewMode);

                showToast(`ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${searchResults.length} Ù†ØªØ§Ø¦Ø¬`);

            } else {

                showToast('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬');

            }

        }

        

        function toggleFullScreen() {

            const elem = document.documentElement;

            if (!document.fullscreenElement) {

                elem.requestFullscreen().catch(err => console.log(err));

            } else {

                document.exitFullscreen();

            }

        }

        

        function closeReader() {

            closeModals();

            currentPdf = null;

            currentBookId = null;

            searchResults = [];

        }

        

        document.getElementById('pageInput').addEventListener('change', (e) => {

            let page = parseInt(e.target.value);

            if (page >= 1 && page <= numPages) {

                currentPage = page;

                changeViewMode(viewMode);

                localStorage.setItem('lastPage_' + currentBookId, currentPage);

            }

        });

        function dataURLtoBlob(dataurl) {

            var arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1],

                bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);

            while(n--) u8arr[n] = bstr.charCodeAt(n);

            return new Blob([u8arr], {type:mime});

        }

        function openEdit(id) {

            db.transaction("books").objectStore("books").get(id).onsuccess = (e) => {

                const b = e.target.result;

                document.getElementById('editBookId').value = b.id;

                document.getElementById('editName').value = b.name;

                document.getElementById('editAuthor').value = b.author || '';

                document.getElementById('editCat').value = b.category;

                document.getElementById('editDesc').value = b.description || '';

                document.getElementById('editModal').style.display = 'block';

            };

        }

        function saveEdit() {

            const id = Number(document.getElementById('editBookId').value);

            const tx = db.transaction("books", "readwrite");

            const store = tx.objectStore("books");

            store.get(id).onsuccess = (e) => {

                const data = e.target.result;

                data.name = document.getElementById('editName').value;

                data.author = document.getElementById('editAuthor').value;

                data.category = document.getElementById('editCat').value;

                data.description = document.getElementById('editDesc').value;

                store.put(data);

                tx.oncomplete = () => { playAudio('success'); closeModals(); render(); showToast("âœ… Ø¹Ø¯Ù„Ù†Ø§ ÙˆÙƒÙ„Ù‡ ØªÙ…Ø§Ù… ÙŠØ§ Ø¨Ø±Ù†Ø³"); };

            };

        }

        function downB(id) {

            playAudio('click');

            showToast("Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„... Ø§Ø³ØªÙ„Ù‚Ø§Ù‡ ğŸ“¥");

            db.transaction("books").objectStore("books").get(id).onsuccess = (e) => {

                const b = e.target.result;

                const a = document.createElement('a'); a.href = b.data; a.download = b.name + ".pdf"; a.click();

            };

        }

        function moveToBin(id) {

            playAudio('trash');

            const tx = db.transaction(["books", "bin"], "readwrite");

            tx.objectStore("books").get(id).onsuccess = (e) => {

                tx.objectStore("bin").add(e.target.result);

                tx.objectStore("books").delete(id);

                tx.oncomplete = () => { render(); updateStats(); showToast("ğŸ—‘ï¸ Ø·ÙŠØ±Ù†Ø§Ù‡ ÙÙŠ Ø§Ù„Ø²Ø¨Ø§Ù„Ø©"); };

            };

        }

        function showBin() {

            const list = document.getElementById('binList'); list.innerHTML = "";

            document.getElementById('binModal').style.display = 'block';

            db.transaction("bin").objectStore("bin").openCursor().onsuccess = (e) => {

                const c = e.target.result;

                if(c) {

                    const row = document.createElement('div'); row.style = "display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #333; align-items:center";

                    row.innerHTML = `<span style="font-size:0.9rem">${c.value.name}</span> <button class="btn-s" style="background:#198754; padding:5px 10px" onclick="restoreBook(${c.value.id})">Ø±Ø¬Ø¹Ù‡ ØªØ§Ù†ÙŠ</button>`;

                    list.appendChild(row); c.continue();

                }

            };

        }

        function restoreBook(id) {

            playAudio('success');

            const tx = db.transaction(["books", "bin"], "readwrite");

            tx.objectStore("bin").get(id).onsuccess = (e) => {

                tx.objectStore("books").add(e.target.result);

                tx.objectStore("bin").delete(id);

                tx.oncomplete = () => { showBin(); render(); updateStats(); showToast("Ø±Ø¬Ø¹Ù†Ø§Ù‡ ÙŠÙ†ÙˆØ± Ø§Ù„Ù…ÙƒØªØ¨Ø© âœ¨"); };

            };

        }

        function emptyBin() {

            if(confirm("Ù‡ØªÙØ±Ù… Ø§Ù„ÙƒØªØ¨ Ø¯ÙŠ Ø¨Ø¬Ø¯ØŸ Ù…ÙÙŠØ´ Ø±Ø¬Ø¹Ø© ÙŠØ§ Ù…Ø¹Ù„Ù…! ğŸ˜±")) {

                playAudio('trash');

                db.transaction("bin", "readwrite").objectStore("bin").clear().onsuccess = () => {

                    closeModals(); updateStats(); showToast("Ø¨Ø­.. Ø§Ù„Ø²Ø¨Ø§Ù„Ø© ÙØ¶ÙŠØª ğŸ§¹");

                };

            }

        }

        function updateStats() {

            let total = 0;

            const tx = db.transaction(["books", "bin"], "readonly");

            tx.objectStore("books").openCursor().onsuccess = (e) => {

                const c = e.target.result;

                if(c) { total += (c.value.size || 0); c.continue(); }

                else document.getElementById('totalStorage').innerText = formatSize(total);

            };

            tx.objectStore("bin").count().onsuccess = (e) => document.getElementById('binCount').innerText = e.target.result;

        }

        function formatSize(bytes) {

            if(!bytes) return '0 B';

            const i = Math.floor(Math.log(bytes) / Math.log(1024));

            return (bytes / Math.pow(1024, i)).toFixed(1) + ' ' + ['B', 'KB', 'MB', 'GB'][i];

        }

        function exportData() {

            const tx = db.transaction("books", "readonly");

            const data = [];

            tx.objectStore("books").openCursor().onsuccess = (e) => {

                const c = e.target.result;

                if(c) { data.push(c.value); c.continue(); }

                else {

                    const a = document.createElement('a');

                    a.href = URL.createObjectURL(new Blob([JSON.stringify(data)], {type: "application/json"}));

                    a.download = "Ziad_Library_Backup.json"; a.click();

                }

            };

        }

        function importData(e) {

            const reader = new FileReader();

            reader.onload = (ev) => {

                const data = JSON.parse(ev.target.result);

                const tx = db.transaction("books", "readwrite");

                data.forEach(item => tx.objectStore("books").add(item));

                tx.oncomplete = () => { playAudio('success'); render(); updateStats(); showToast("âœ… Ø±Ø¬Ø¹Ù†Ø§ Ø§Ù„ÙƒØªØ¨ ÙŠØ§ ÙˆØ­Ø´"); };

            };

            reader.readAsText(e.target.files[0]);

        }

        function choosePasswordMode() {

            localStorage.setItem('ziadMode', 'password');

            showPage('loginPage');

            checkFirstVisit();

        }

        function chooseNoPasswordMode() {

            localStorage.setItem('ziadMode', 'noPassword');

            enterLibrary();

        }

        init();

    </script>

</body>

</html>